<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Goals Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#64748b',
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --bg-color: #f4f6f8;
            --surface-color: #ffffff;
            --primary-color: #3b82f6;
            --primary-hover: #2563eb;
            --secondary-color: #64748b;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --blocked-color: #ef4444;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);

            /* Nordic Matte Palette */
            --c-all: #4c566a;
            /* Polar Night */
            --c-short: #88c0d0;
            /* Frost Blue */
            --c-long: #b48ead;
            /* Aurora Purple */
            --c-prof: #5e81ac;
            /* Kold Blue */
            --c-pers: #a3be8c;
            /* Aurora Green */

            --c-todo: #94a3b8;
            --c-doing: #3b82f6;
            --c-done: #10b981;
            --c-block: #ef4444;
        }

        body.dark {
            --bg-color: #0f172a;
            --surface-color: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.5), 0 2px 4px -2px rgb(0 0 0 / 0.3);

            /* Dark mode palette adjustments */
            --c-todo: #cbd5e1;
            --c-doing: #60a5fa;
            --c-done: #34d399;
            --c-block: #f87171;

            /* Nordic Adjustments for Dark */
            --c-all: #e5e9f0;
            --c-short: #8fbcbb;
            --c-long: #b48ead;
            --c-prof: #81a1c1;
            --c-pers: #a3be8c;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Typescale */
        h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        h3 {
            font-size: 1rem;
            font-weight: 600;
        }

        .text-sm {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .text-xs {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Layout */
        header {
            background: var(--surface-color);
            border-bottom: 1px solid var(--border-color);
            padding: 1.5rem 2rem;
            /* Increased padding for title space */
            min-height: 100px;
            /* Ensure space for absolute title */
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        nav {
            display: flex;
            gap: 1rem;
            /* Border handling moved to ::before for symmetry */
            position: relative;
            padding-left: 1.5rem;
            margin-left: auto;
            /* Push to right if not already */
            align-items: center;
        }

        /* Fixed height divider for Navigation */
        nav::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            height: 50px;
            /* Fixed height for symmetry */
            width: 1px;
            background-color: var(--border-color);
        }

        /* Fixed height divider for Date/Time */
        #header-datetime {
            position: relative;
        }

        #header-datetime::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            height: 50px;
            /* Fixed height for symmetry */
            width: 1px;
            background-color: var(--border-color);
        }

        .dark-toggle {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1rem;
            transition: color 0.2s;
            margin-left: auto;
            /* push to far right */
        }

        .dark-toggle:hover {
            color: var(--primary-color);
        }

        .nav-btn {
            background: transparent;
            border: none;
            padding: 0.5rem 1rem;
            cursor: pointer;
            color: var(--text-secondary);
            font-weight: 500;
            border-radius: var(--radius);
            transition: all 0.2s;
        }

        .nav-btn:hover {
            background-color: var(--bg-color);
            color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .nav-btn.active {
            background-color: var(--bg-color);
            color: var(--primary-color);
            font-weight: 600;
        }

        main {
            flex: 1;
            padding: 2rem;
            max-width: 90%;
            /* Increased from 1200px to occupy more space */
            margin: 0 auto;
            width: 100%;
        }

        @media (max-width: 768px) {
            main {
                max-width: 100%;
                padding: 1rem;
            }
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Grid */
        .grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-cols-2 {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            /* Reduced from 350px for mobile */
        }

        .grid-cols-4 {
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            /* Reduced from 200px */
        }

        /* Cards */
        .card {
            background: var(--surface-color);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .stat-card {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Forms */
        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            font-size: 0.875rem;
            gap: 0.5rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
        }

        .btn-secondary {
            background-color: white;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background-color: var(--bg-color);
        }

        .btn-danger {
            background-color: #fee2e2;
            color: var(--danger-color);
        }

        .btn-danger:hover {
            background-color: #fecaca;
        }

        /* Category Badges */
        .badge-category-short-term {
            background: #0ea5e9;
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            padding: 2px 8px;
            text-transform: uppercase;
        }

        .badge-category-long-term {
            background: #7c3aed;
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            padding: 2px 8px;
            text-transform: uppercase;
        }

        .badge-category-lifetime {
            background: #db2777;
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            padding: 2px 8px;
            text-transform: uppercase;
        }

        body.dark .badge-category-short-term {
            background: #0ea5e9;
            color: white;
        }

        body.dark .badge-category-long-term {
            background: #7c3aed;
            color: white;
        }

        body.dark .badge-category-lifetime {
            background: #db2777;
            color: white;
        }



        .btn-action {
            padding: 0.25rem;
        }

        /* Goal Item */
        .goal-group-title {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .goal-card {
            background: var(--surface-color);
            padding: 1rem;
            margin-bottom: 0.85rem;
            border-radius: 1.15rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            gap: 0.65rem;
            position: relative;
            border: 1px solid var(--border-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            cursor: pointer;
            min-height: 120px;
            /* 120% of previous 100px */
        }

        body.dark .goal-card {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .goal-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 20px -5px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }

        .goal-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: transparent;
            transition: background 0.3s;
        }

        .goal-card.priority-high::before {
            background: linear-gradient(to bottom, #ef4444, #b91c1c);
        }

        .goal-card.priority-medium::before {
            background: linear-gradient(to bottom, #f59e0b, #b45309);
        }

        .goal-card.priority-low::before {
            background: linear-gradient(to bottom, #10b981, #047857);
        }

        /* Compact Layout Components */
        .card-main {
            display: flex;
            gap: 1.25rem;
            align-items: center;
            flex: 1;
        }

        .card-left {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }

        .card-right {
            flex: 0 0 120px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: center;
            gap: 0.5rem;
            border-left: 1px solid var(--border-color);
            padding-left: 1rem;
        }

        body.dark .card-right {
            border-left-color: rgba(255, 255, 255, 0.05);
        }

        .card-footer-compact {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.65rem;
            color: #94a3b8;
            margin-top: auto;
            border-top: 1px solid transparent;
        }



        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.35rem 0.75rem;
            border-radius: 0.75rem;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .badge-priority-high {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .badge-priority-medium {
            background: linear-gradient(135deg, #ffedd5 0%, #fed7aa 100%);
            color: #9a3412;
            border: 1px solid #fed7aa;
        }

        .badge-priority-low {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .badge-status-not-started {
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #e2e8f0;
        }

        .badge-status-in-progress {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }

        .badge-status-completed {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .badge-status-blocked {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .card-action-trigger {
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: background 0.2s;
            color: #94a3b8;
        }

        .card-action-trigger:hover {
            background: rgba(0, 0, 0, 0.05);
            color: var(--primary-color);
        }

        /* --- PREMIUM HEADER STANDARDS --- */
        .header-standard {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            gap: 1.5rem;
        }

        @media (max-width: 991px) {
            .header-standard {
                flex-direction: column;
                text-align: center;
                gap: 1.5rem;
            }

            .header-standard>div {
                width: 100%;
                justify-content: center !important;
                flex: none !important;
            }

            .header-standard .flex-1.flex.items-center.gap-6 {
                flex-direction: column;
                gap: 1rem;
            }
        }

        /* Simplified Icons: Default naked, Solid Hover */
        .icon-premium {
            padding: 0.65rem;
            border-radius: 9999px;
            background: transparent;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-premium:active {
            transform: scale(0.9);
        }

        .icon-amber {
            color: #f59e0b;
        }

        .icon-amber:hover {
            background: #f59e0b;
            color: white;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
        }

        .icon-blue {
            color: #3b82f6;
        }

        .icon-blue:hover {
            background: #3b82f6;
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }

        .icon-violet {
            color: #8b5cf6;
        }

        .icon-violet:hover {
            background: #8b5cf6;
            color: white;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.2);
        }

        .icon-emerald {
            color: #10b981;
        }

        .icon-emerald:hover {
            background: #10b981;
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }

        /* Info Icons (the "i" button) */
        .btn-info {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 1.5px solid var(--primary-color);
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 800;
            cursor: pointer;
            background: transparent;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            flex-shrink: 0;
        }

        .btn-info:hover {
            background: var(--primary-color);
            color: white;
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }

        .btn-info-emerald {
            border-color: #10b981;
            color: #10b981;
        }

        .btn-info-emerald:hover {
            background: #10b981;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }

        .btn-info-amber {
            border-color: #f59e0b;
            color: #f59e0b;
        }

        .btn-info-amber:hover {
            background: #f59e0b;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
        }

        .btn-info-blue {
            border-color: #3b82f6;
            color: #3b82f6;
        }

        .btn-info-blue:hover {
            background: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }

        /* Premium Buttons: Solid Hover */
        .btn-premium-action {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1.25rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
            border: 1px solid #e2e8f0;
            color: #64748b;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        body.dark .btn-premium-action {
            background: rgba(30, 41, 59, 0.8);
            border-color: #334155;
            color: #94a3b8;
        }

        /* Solid Blue Hover - Standard in App */
        .btn-premium-action:hover {
            background: #3b82f6 !important;
            color: white !important;
            border-color: #3b82f6 !important;
            transform: translateY(-1px) scale(1.02);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn-premium-action:active {
            transform: scale(0.95);
        }

        /* Info Popover */
        .info-tooltip-wrapper {
            position: relative;
            display: inline-flex;
            align-items: center;
        }

        .info-popover {
            position: absolute;
            top: calc(100% + 12px);
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            width: 320px;
            background: var(--surface-color);
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            text-align: left;
        }

        /* Show on hover unless force-hidden */
        .info-tooltip-wrapper:hover .info-popover:not(.force-hidden) {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
            pointer-events: auto;
        }

        /* Triangle for popover */
        .info-popover::before {
            content: '';
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%) rotate(45deg);
            width: 12px;
            height: 12px;
            background: var(--surface-color);
            border-left: 1px solid var(--border-color);
            border-top: 1px solid var(--border-color);
        }

        .popover-right {
            left: auto !important;
            right: 0 !important;
            transform: translateY(10px) !important;
        }

        .info-tooltip-wrapper:hover .info-popover.popover-right:not(.force-hidden) {
            transform: translateY(0) !important;
        }

        .popover-right::before {
            left: auto !important;
            right: 14px !important;
            transform: rotate(45deg) !important;
        }

        .force-hidden {
            display: none !important;
        }

        body.dark .info-popover {
            background: #1e293b;
            border-color: #334155;
        }

        body.dark .info-popover::before {
            background: #1e293b;
            border-color: #334155;
        }

        .btn-blue-hover:hover {
            background-color: #3b82f6 !important;
            color: white !important;
            border-color: #3b82f6 !important;
        }

        .btn-red-hover:hover {
            background-color: #ef4444 !important;
            color: white !important;
            border-color: #ef4444 !important;
        }

        body.dark .card-action-trigger:hover {
            background: rgba(255, 255, 255, 0.1);
        }


        .progress-bar-container {
            width: 100%;
            height: 6px;
            background-color: var(--border-color);
            border-radius: 999px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            transition: width 0.5s ease;
        }

        .dependency-tag {
            font-size: 0.75rem;
            color: var(--danger-color);
            display: flex;
            align-items: center;
            gap: 0.25rem;
            margin-top: 0.25rem;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            text-align: left;
        }

        th,
        td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        tr:hover {
            background-color: #f8fafc;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        /* Helpers */
        .flex {
            display: flex;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .gap-2 {
            gap: 0.5rem;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        .w-full {
            width: 100%;
        }

        /* Toast */
        #toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: var(--text-primary);
            color: white;
            padding: 10px 20px;
            border-radius: var(--radius);
            font-size: 0.875rem;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Chart */
        .chart-container {
            height: 200px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            padding-top: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .bar-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            flex: 1;
        }

        .bar {
            width: 30px;
            background: var(--primary-color);
            border-radius: 4px 4px 0 0;
            transition: height 0.5s ease;
            min-height: 4px;
        }

        .bar-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .clickable {
            cursor: pointer;
            transition: transform 0.1s;
        }

        .clickable:active {
            transform: scale(0.98);
        }

        /* Filter Card Styling */
        /* Updated Filter Button Styling for Premium Visualization */
        .filter-section {
            display: flex;
            align-items: center;
            justify-content: space-between !important;
            /* Force spread */
            padding: 1rem 1.25rem;
            width: 100%;
            border: none;
            background: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .filter-section-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .filter-content-text {
            display: flex;
            flex-direction: column;
            align-items: start;
        }

        .filter-label-main {
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: -0.01em;
            line-height: 1.1;
        }

        .filter-label-sub {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            opacity: 0.8;
            margin-bottom: 2px;
        }

        .filter-badge-pill {
            font-size: 1rem;
            font-weight: 700;
            opacity: 0.9;
            transition: all 0.2s;
        }

        .filter-section:hover {
            transform: translateY(-3px);
            background: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .filter-section.active {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.15);
        }

        /* Override active for pill */
        .filter-section.active .filter-badge-pill,
        .filter-section.active .filter-badge-pct {
            color: white !important;
            opacity: 1;
        }

        .filter-badge-container {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: center;
            line-height: 1;
        }

        .filter-badge-pct {
            font-size: 0.7rem;
            font-weight: 600;
            opacity: 0.7;
            margin-top: 4px;
        }

        .table-select-filter {
            width: 100%;
            padding: 4px 20px 4px 8px;
            font-size: 0.7rem;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            background: #ffffff;
            color: #475569;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394a3b8'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 6px center;
            background-size: 10px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .table-select-filter:hover {
            border-color: #cbd5e1;
            background-color: #f8fafc;
        }

        .table-select-filter:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1);
        }

        /* Status Colors - Redefine for new structure */
        .btn-theme-todo {
            color: var(--c-todo);
            background: rgba(148, 163, 184, 0.05);
        }

        .btn-theme-todo.active {
            background-color: var(--c-todo);
            color: white;
        }

        .btn-theme-doing {
            color: var(--c-doing);
            background: rgba(59, 130, 246, 0.05);
        }

        .btn-theme-doing.active {
            background-color: var(--c-doing);
            color: white;
        }

        .btn-theme-done {
            color: var(--c-done);
            background: rgba(16, 185, 129, 0.05);
        }

        .btn-theme-done.active {
            background-color: var(--c-done);
            color: white;
        }

        .btn-theme-block {
            color: var(--c-block);
            background: rgba(239, 68, 68, 0.05);
        }

        .btn-theme-block.active {
            background-color: var(--c-block);
            color: white;
        }

        .btn-theme-all {
            color: var(--c-all);
            background: rgba(76, 86, 106, 0.05);
        }

        .btn-theme-all.active {
            background-color: var(--c-all);
            color: white;
        }

        .btn-theme-overdue {
            color: var(--warning-color);
            background: rgba(245, 158, 11, 0.05);
        }

        .btn-theme-overdue.active {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-theme-short {
            color: var(--c-short);
            background: rgba(136, 192, 208, 0.05);
        }

        .btn-theme-short.active {
            background-color: var(--c-short);
            color: white;
        }

        .btn-theme-long {
            color: var(--c-long);
            background: rgba(180, 142, 173, 0.05);
        }

        .btn-theme-long.active {
            background-color: var(--c-long);
            color: white;
        }

        .btn-theme-prof {
            color: var(--c-prof);
            background: rgba(94, 129, 172, 0.05);
        }

        .btn-theme-prof.active {
            background-color: var(--c-prof);
            color: white;
        }

        .btn-theme-pers {
            color: var(--c-pers);
            background: rgba(163, 190, 140, 0.05);
        }

        .btn-theme-pers.active {
            background-color: var(--c-pers);
            color: white;
        }

        /* Icon Styling */
        .filter-icon {
            width: 24px;
            height: 24px;
            stroke-width: 2;
            opacity: 0.9;
        }

        /* Updated Grid for Equal Button Distribution */
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 1rem;
        }

        /* Top Row: Term and Type (Equal width) */
        .filter-grid>.card:nth-child(1),
        .filter-grid>.card:nth-child(2) {
            grid-column: span 3;
        }

        /* Bottom Row: All Goals (1/6) and Status (5/6) */
        .filter-grid>.card:nth-child(3) {
            grid-column: span 1;
        }

        .filter-grid>.card:nth-child(4) {
            grid-column: span 5;
        }

        .badge-count {
            background: rgba(0, 0, 0, 0.1);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-left: 6px;
        }

        .filter-section.active .badge-count {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Status Colors */
        .btn-theme-todo {
            color: var(--c-todo);
            background: rgba(148, 163, 184, 0.1);
        }

        .btn-theme-todo.active {
            background-color: var(--c-todo);
            color: white;
        }

        .btn-theme-doing {
            color: var(--c-doing);
            background: rgba(59, 130, 246, 0.1);
        }

        .btn-theme-doing.active {
            background-color: var(--c-doing);
            color: white;
        }

        .btn-theme-done {
            color: var(--c-done);
            background: rgba(16, 185, 129, 0.1);
        }

        .btn-theme-done.active {
            background-color: var(--c-done);
            color: white;
        }

        .btn-theme-block {
            color: var(--c-block);
            background: rgba(239, 68, 68, 0.1);
        }

        .btn-theme-block.active {
            background-color: var(--c-block);
            color: white;
        }

        .btn-theme-overdue {
            color: var(--warning-color);
            background: rgba(245, 158, 11, 0.1);
        }

        .btn-theme-overdue.active {
            background-color: var(--warning-color);
            color: white;
        }

        /* Header Customization removed */

        .header-content {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            width: max-content;
        }



        #app-title {
            position: sticky;
            top: 0;
            background: var(--surface-color);
            z-index: 11;
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--c-prof);
            /* Eye soothing blue */
            margin: 0;
            margin-bottom: 0.2rem;
            line-height: 1.2;
        }

        #app-subtitle {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }




        @media (max-width: 1024px) {
            .filter-grid {
                grid-template-columns: 1fr 1fr;
            }

            .filter-grid>.card {
                grid-column: auto !important;
            }

            /* First card full width on tablet to match 4-item card? Or keep 2x2? 
               Let's go for standard 2-col on tablet. */
            .filter-grid>.card:nth-child(2) {
                grid-column: span 2 !important;
            }
        }

        @media (max-width: 768px) {
            .filter-grid {
                grid-template-columns: 1fr;
            }

            .filter-grid>.card {
                grid-column: auto !important;
            }

            header {
                flex-direction: column;
                height: auto;
                min-height: auto;
                gap: 1rem;
                padding: 1rem;
            }

            .header-content {
                position: static;
                transform: none;
                width: 100%;
                margin: 0.5rem 0;
                order: 2;
            }

            /* Hide dividers on mobile */
            nav::before,
            #header-datetime::after {
                display: none;
            }

            #header-datetime {
                order: 1;
                border-right: none;
                margin-right: 0;
                padding-right: 0;
            }

            /* Responsive Filter Section Borders */
            .filter-grid .card button.filter-section {
                border-right: none !important;
            }

            @media (min-width: 768px) {
                .filter-grid .card button.filter-section {
                    border-bottom: none !important;
                    border-right: 1px solid var(--border-color) !important;
                }

                .filter-grid .card button.filter-section:last-child {
                    border-right: none !important;
                }
            }

            #header-datetime #time-display {
                font-size: 1.5rem !important;
                /* Smaller time on mobile */
            }

            nav {
                order: 3;
                position: static;
                width: 100%;
                justify-content: center;
                border-left: none;
                padding-left: 0;
                margin-left: 0;
                flex-wrap: wrap;
            }

            #app-title {
                font-size: 1.75rem;
                /* Slightly smaller title */
            }

            .kanban-board-container {
                display: flex;
                overflow-x: auto;
                padding-bottom: 1rem;
                gap: 1rem;
                -webkit-overflow-scrolling: touch;
            }

            .kanban-column {
                min-width: 280px !important;
                flex: 0 0 280px !important;
            }

            .info-popover {
                width: 280px !important;
                left: 50% !important;
                transform: translateX(-50%) !important;
                right: auto !important;
            }
        }

        /* Tabs Styling */
        .tabs-nav {
            display: flex;
            gap: 1rem;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
        }

        .tab-btn {
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            padding: 0.5rem 1rem;
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            color: var(--c-prof);
            background: rgba(0, 0, 0, 0.02);
        }

        .tab-btn:active {
            transform: scale(0.95);
        }

        .tab-btn-mini {
            background: transparent;
            border: none;
            padding: 0.4rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 9999px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid transparent;
        }

        .tab-btn-mini:hover {
            background: rgba(0, 0, 0, 0.05);
            color: var(--text-primary);
        }

        body.dark .tab-btn-mini:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .tab-btn-mini.active {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
            border-color: rgba(16, 185, 129, 0.2);
        }

        body.dark .tab-btn-mini.active {
            background: rgba(16, 185, 129, 0.15);
            color: #34d399;
            border-color: rgba(52, 211, 153, 0.3);
        }

        .tab-panel {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Dark Mode Input & Overview Fixes */
        body.dark .filter-section {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }

        body.dark .filter-section:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        body.dark .btn-theme-all {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
        }

        body.dark .btn-theme-all.active {
            background: #475569;
            /* Slate 600 */
            color: white;
        }

        body.dark input,
        body.dark select {
            background-color: #1e293b;
            color: white;
            border-color: #334155;
        }

        body.dark .btn-secondary {
            background-color: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-secondary);
        }

        body.dark .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border-color: white;
        }

        /* Dark Mode Table Fixes */
        body.dark tr:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        body.dark th,
        body.dark td {
            border-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        body.dark th {
            color: var(--text-secondary);
        }

        /* Calendar Dark Mode Overrides */
        body.dark .fc {
            --fc-page-bg-color: var(--surface-color);
            --fc-neutral-bg-color: rgba(255, 255, 255, 0.05);
            --fc-neutral-text-color: var(--text-secondary);
            --fc-border-color: var(--border-color);
            --fc-button-text-color: var(--text-primary);
            --fc-button-bg-color: rgba(255, 255, 255, 0.05);
            --fc-button-border-color: rgba(255, 255, 255, 0.1);
            --fc-button-hover-bg-color: rgba(255, 255, 255, 0.1);
            --fc-button-active-bg-color: var(--primary-color);
            --fc-event-bg-color: var(--primary-color);
            --fc-event-border-color: var(--primary-color);
            --fc-today-bg-color: rgba(255, 255, 255, 0.02);
            --fc-list-event-hover-bg-color: rgba(255, 255, 255, 0.05);
        }

        body.dark .fc-theme-standard td,
        body.dark .fc-theme-standard th,
        body.dark .fc-theme-standard .fc-scrollgrid {
            border-color: var(--border-color);
        }

        body.dark .fc .fc-toolbar-title {
            color: var(--text-primary);
        }

        body.dark .fc-daygrid-day-number {
            color: var(--text-primary);
        }

        body.dark .fc-col-header-cell-cushion {
            color: var(--text-secondary);
        }

        /* Calendar Card & Layout */
        #calendar {
            font-family: 'Inter', sans-serif;
        }

        .fc-event {
            cursor: pointer;
            border-radius: 4px;
            font-size: 0.85rem;
            border: none;
            margin-bottom: 2px;
            overflow: hidden;
            background: white !important;
            /* Force legible background */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05) !important;
            padding-left: 6px;
            /* Space for the colored bar */
        }

        body.dark .fc-event {
            background: #334155 !important;
            /* Slate 700 background in dark mode */
            color: #f1f5f9 !important;
            /* Slate 100 text */
        }

        /* The colored bar */
        .fc-event::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            border-top-left-radius: 4px;
            border-bottom-left-radius: 4px;
            background-color: currentColor;
            /* Uses text color or specific variable */
        }

        /* Remove previous pseudo-element strategy if using border-left directly is easier, 
           but FullCalendar inserts its own borders. Let's stick to border-left on the container. */
        .fc-event::before {
            display: none;
        }

        /* Custom Event Content */
        .fc-event-content {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 2px 4px;
        }

        .dot-status {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: white;
        }

        /* Checkbox Styling */
        input[type="checkbox"] {
            accent-color: var(--primary-color);
            width: 1rem;
            height: 1rem;
            cursor: pointer;
        }

        /* Calendar Redesign - Planning First */
        .fc-event-main-content {
            font-size: 0.75rem;
            font-weight: 600;
            white-space: normal;
            word-wrap: break-word;
            padding: 4px 6px;
            line-height: 1.5;
            letter-spacing: -0.01em;
        }

        /* Board & Info Icons */
        .btn-info {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-style: italic;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 14px;
        }

        .btn-info:hover {
            background: var(--primary-color);
            color: white;
            transform: rotate(-10deg) scale(1.1);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .board-btn-premium {
            background: white;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 0.4rem 1rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 700;
            transition: all 0.2s;
            cursor: pointer;
        }

        .board-btn-premium:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }

        body.dark .board-btn-premium {
            background: rgba(255, 255, 255, 0.03);
            border-color: rgba(255, 255, 255, 0.1);
        }

        body.dark .board-btn-premium:hover {
            background: var(--primary-color);
            color: white;
        }

        /* TimeGrid Event Styling (Neutral Block) */
        .fc-timegrid-event {
            background-color: #f8fafc !important;
            /* Neutral Slate 50 */
            border: none !important;
            border-left: 4px solid var(--border-color) !important;
            /* Default border */
            border-radius: 4px !important;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            color: var(--text-primary) !important;
        }

        /* Dark Mode Override */
        body.dark .fc-timegrid-event {
            background-color: rgba(30, 41, 59, 0.7) !important;
            color: var(--text-primary) !important;
        }

        .fc .fc-button {
            text-transform: capitalize !important;
        }

        /* Status Borders */
        .status-border-todo {
            border-left-color: var(--c-todo) !important;
        }

        .status-border-doing {
            border-left-color: var(--c-doing) !important;
        }

        .status-border-done {
            border-left-color: var(--c-done) !important;
        }

        .status-border-block {
            border-left-color: var(--c-block) !important;
        }

        /* Draggable Items */
        .draggable-item {
            cursor: move;
            /* fallback */
            cursor: grab;
            transition: transform 0.2s, box-shadow 0.2s;
            user-select: none;
        }

        .draggable-item:active {
            cursor: grabbing;
            transform: scale(1.02);
            box-shadow: var(--shadow);
        }

        .fc-highlight {
            background: rgba(59, 130, 246, 0.05) !important;
        }

        /* PREMIUM CUSTOMIZATION STYLES */
        .custom-property-panel {
            background: rgba(0, 0, 0, 0.02);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 1.5rem;
            transition: all 0.2s;
        }

        body.dark .custom-property-panel {
            background: rgba(255, 255, 255, 0.02);
        }

        .custom-property-toolbar {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            background: rgba(248, 250, 252, 0.5);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        @media (min-width: 768px) {
            .custom-property-toolbar {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .custom-property-toolbar {
                display: flex;
                flex-wrap: wrap;
            }
        }

        body.dark .custom-property-toolbar {
            background: rgba(30, 41, 59, 0.4);
            border-color: rgba(255, 255, 255, 0.05);
        }

        .custom-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .custom-item label {
            font-size: 0.65rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
            margin: 0;
        }

        /* Stylized Toggle Button for Italic */
        .style-toggle-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 42px;
            width: 42px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }

        body.dark .style-toggle-btn {
            background: #1e293b;
            border-color: #334155;
        }

        /* Stylized Color Swatch */
        .color-swatch-container {
            position: relative;
            height: 42px;
            width: 42px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .dr-input {
            width: 100%;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.6rem 0.8rem;
            font-size: 0.9rem;
            color: var(--text-primary);
            transition: all 0.2s;
        }

        body.dark .dr-input {
            background: #1e293b;
            border-color: #334155;
        }

        /* Premium Toolbar Styles */
        .premium-toolbar {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        body.dark .premium-toolbar {
            background: rgba(30, 41, 59, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .search-container {
            position: relative;
            flex: 2;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            pointer-events: none;
            width: 18px;
            height: 18px;
        }

        .search-input {
            padding-left: 40px !important;
            height: 44px;
            font-size: 0.875rem;
            font-weight: 500;
            font-family: inherit;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .search-input:focus {
            background: var(--surface-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn-clear-search {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            cursor: pointer;
            visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4px;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .btn-clear-search:hover {
            background: rgba(0, 0, 0, 0.05);
            color: var(--danger-color);
        }

        .search-input:not(:placeholder-shown)~.btn-clear-search {
            visibility: visible;
        }

        .premium-select-wrapper {
            position: relative;
            flex: 1;
        }

        .dropdown-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            pointer-events: none;
            width: 18px;
            height: 18px;
            z-index: 5;
        }

        .premium-select {
            height: 44px;
            appearance: none;
            padding-left: 40px !important;
            padding-right: 36px !important;
            font-size: 0.875rem;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .premium-select:focus {
            background: var(--surface-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .select-chevron {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: var(--text-secondary);
            width: 18px;
            height: 18px;
        }

        .results-counter {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-right: auto;
            font-weight: 500;
            letter-spacing: -0.01em;
        }

        .results-counter span {
            color: var(--primary-color);
            font-weight: 700;
        }

        /* Kanban Board Styles */
        .kanban-board-container {
            display: flex;
            overflow-x: auto;
            gap: 1.5rem;
            padding-bottom: 1rem;
            /* calc(100vh - header - page_padding - board_header_controls) */
            height: calc(100vh - 220px);
            min-height: 500px;
            scroll-behavior: smooth;
        }

        .kanban-column {
            flex: 1;
            /* Expand to fill width */
            min-width: 300px;
            /* Minimum legible width */
            resize: horizontal;
            /* Allow resizing */
            overflow: hidden;
            /* Required for resize to work */
            background: rgba(255, 255, 255, 0.4);
            border-radius: var(--radius);
            padding: 1rem;
            display: flex;
            flex-direction: column;
            height: 100%;
            border: 1px solid var(--border-color);
            transition: background 0.2s, border-color 0.2s;
            position: relative;
            /* Context for overflow */
        }

        body.dark .kanban-column {
            background: rgba(30, 41, 59, 0.4);
        }

        .kanban-header {
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-bottom: 0.8rem;
            border-bottom: 2px solid transparent;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 0.85rem;
            /* Ensure header doesn't get messed up by resize overflow */
            flex-shrink: 0;
        }

        /* Update Info Button to be more prominent/icon-like */
        .btn-info {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            background: rgba(59, 130, 246, 0.1);
            font-size: 1rem;
            font-weight: 800;
            font-family: serif;
            /* distinct styled 'i' */
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            margin-right: 0.75rem;
            /* Space to the right now */
            margin-left: 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .btn-info:hover {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .kanban-cards-area {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            padding-right: 4px;
        }

        /* Custom Scrollbar for columns */
        .kanban-cards-area::-webkit-scrollbar {
            width: 4px;
        }

        .kanban-cards-area::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        .kanban-card {
            background: var(--surface-color);
            padding: 1rem;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
            cursor: grab;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
            position: relative;
        }

        body.dark .kanban-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(8px);
        }

        .kanban-card:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 16px -4px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
            z-index: 10;
        }

        .kanban-card:active {
            cursor: grabbing;
        }

        .kanban-card.dragging {
            opacity: 0.4;
            border: 2px dashed var(--primary-color);
            transform: scale(0.95);
        }

        .kanban-column.drag-over {
            background: rgba(59, 130, 246, 0.1);
            border: 2px dashed var(--primary-color);
        }

        .kanban-tag {
            font-size: 0.6rem;
            padding: 2px 6px;
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.05);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }



        /* Updated Board Height for 80% coverage w/o outer scroll */
        .kanban-board-container {
            /* calc(100vh - header - page_padding - board_header_controls) */
            /* approx: 100px header + 40px padding + 40px controls + padding = ~220px offset */
            height: calc(100vh - 220px);
            min-height: 500px;
            padding-bottom: 0.5rem;
            /* reduce padding to keep tight */
            position: relative;
            /* Context for absolute trash zone */
        }

        /* --- TRASH DROP ZONE --- */
        .trash-zone {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(150%);
            width: 300px;
            height: 60px;
            background: #fee2e2;
            border: 2px dashed #ef4444;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ef4444;
            font-weight: bold;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 50;
            opacity: 0;
            pointer-events: none;
        }

        .kanban-board-container.dragging-active .trash-zone {
            transform: translateX(-50%) translateY(0);
            opacity: 0.9;
            pointer-events: auto;
        }

        .trash-zone.drag-over {
            background: #ef4444;
            color: white;
            box-shadow: 0 10px 15px -3px rgba(239, 68, 68, 0.5);
            transform: translateX(-50%) scale(1.1);
            opacity: 1;
        }

        body.dark .trash-zone {
            background: #450a0a;
            border-color: #ef4444;
            color: #fca5a5;
        }

        body.dark .trash-zone.drag-over {
            background: #ef4444;
            color: white;
        }

        /* --- CONTROLS --- */
        .board-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: var(--surface-color);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
        }

        /* Standard appearance property */
        .width-slider {
            appearance: none;
            -webkit-appearance: none;
            width: 100px;
            /* ... rest of styles ... */
            height: 4px;
            background: var(--border-color);
            border-radius: 2px;
            outline: none;
        }

        .width-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            transition: transform 0.1s;
        }

        .width-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        /* --- TIMELINE / ATTENTION VIEW --- */
        .timeline-section-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1rem;
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .timeline-card {
            display: flex;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 1rem;
            gap: 1rem;
            align-items: center;
            transition: all 0.2s;
        }

        body.dark .timeline-card {
            background: rgba(30, 41, 59, 0.6);
        }

        .timeline-card:hover {
            border-color: var(--primary-color);
            transform: translateX(4px);
        }

        .deadline-badge {
            font-size: 0.75rem;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 20px;
            white-space: nowrap;
        }

        .deadline-critical {
            background: #fee2e2;
            color: #ef4444;
        }

        .deadline-soon {
            background: #ffedd5;
            color: #f97316;
        }

        .deadline-safe {
            background: #dcfce7;
            color: #10b981;
        }

        body.dark .deadline-critical {
            background: #450a0a;
            color: #fca5a5;
        }

        body.dark .deadline-soon {
            background: #431407;
            color: #fdba74;
        }

        body.dark .deadline-safe {
            background: #052e16;
            color: #86efac;
        }


        /* --- ENHANCED TOASTS --- */
        #toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .toast {
            background: white;
            color: #1e293b;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            min-width: 300px;
            border-left: 4px solid var(--primary-color);
            animation: slideIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            transition: all 0.3s;
        }

        body.dark .toast {
            background: #1e293b;
            color: #f1f5f9;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }

        .toast-success {
            border-left-color: #10b981;
        }

        .toast-error {
            border-left-color: #ef4444;
        }

        .toast-info {
            border-left-color: #3b82f6;
        }

        .toast-warning {
            border-left-color: #f59e0b;
        }

        .toast-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .toast-success .toast-icon {
            color: #10b981;
            background: #ecfdf5;
        }

        .toast-error .toast-icon {
            color: #ef4444;
            background: #fef2f2;
        }

        body.dark .toast-success .toast-icon {
            background: #064e3b;
        }

        body.dark .toast-error .toast-icon {
            background: #450a0a;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <header>
        <!-- Date/Time Display -->
        <div id="header-datetime" class="flex flex-col items-center text-center gap-2 mr-8 pr-8 min-w-[140px]">
            <div id="date-display" class="text-xs font-bold uppercase tracking-wider text-secondary"></div>
            <div id="time-display" class="text-2xl font-bold leading-none tracking-tight uppercase"></div>
        </div>

        <div class="header-content">
            <h1 id="app-title">GoalDash</h1>
            <div id="app-subtitle">Your personal goals dashboard</div>
        </div>
        <nav>
            <button class="nav-btn active" onclick="app.setPage('overview')">Overview</button>
            <button class="nav-btn" onclick="app.setPage('tracking')">Goals</button>
            <button class="nav-btn" onclick="app.setPage('board')" title="Agile Board View"
                style="padding: 0.25rem 0.5rem; display: flex; align-items: center; gap: 4px;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="9" y1="3" x2="9" y2="21"></line>
                </svg>
                Board
            </button>
            <button class="nav-btn" onclick="app.setPage('attention')" title="Attention Timeline"
                style="padding: 0.25rem 0.5rem; display: flex; align-items: center; gap: 4px;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                Attention
            </button>
            <div style="width: 1px; height: 24px; background: var(--border-color); margin: 0 0.5rem; opacity: 0.5;">
            </div>
            <button class="nav-btn" onclick="app.setPage('customize')" title="Customize Dashboard"
                style="padding: 0.25rem 0.5rem;">
                <span class="text-xl"></span>
            </button>
            <button class="nav-btn" onclick="app.setPage('calendar')" title="Calendar" style="padding: 0.25rem 0.5rem;">
                <span class="text-xl"></span>
            </button>
            <button id="dark-toggle-btn" class="dark-toggle" onclick="toggleDarkMode()"
                aria-label="Toggle dark mode"></button>
        </nav>
    </header>

    <main>
        <!-- PAGE A: OVERVIEW -->
        <section id="page-overview" class="page active">
            <!-- 3-Column Header Standardized -->
            <div class="header-standard">
                <div class="flex-1">
                    <div class="info-tooltip-wrapper" onmouseenter="app.resetPopover(event)">
                        <div class="icon-premium icon-blue" title="Systems Nominal">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                                <circle cx="12" cy="12" r="10" stroke-opacity="0.2" />
                            </svg>
                        </div>
                        <!-- Popover Content -->
                        <div class="info-popover text-left">
                            <div
                                class="flex justify-between items-center mb-4 border-b border-slate-100 dark:border-slate-700 pb-2">
                                <h3 class="text-xs font-bold uppercase tracking-widest text-primary">Overview Guide</h3>
                                <button onclick="app.closePopover(event)"
                                    class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 p-1">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-4 text-xs text-slate-600 dark:text-slate-300">
                                <div>
                                    <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">1. System Health</h4>
                                    <p>Monitor your goal pipeline and urgency distribution in real-time.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">2. Quick Filters</h4>
                                    <p>Use Nordic cards to instantly isolate goals by Term, Type, or Status.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">3. Active Triage</h4>
                                    <p>Charts provide a high-level view of what's on track and what's blocked.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex-none text-center px-4">
                    <h2 class="text-2xl font-bold text-slate-800 dark:text-white">Dashboard Overview</h2>
                    <p class="text-sm text-secondary font-medium uppercase tracking-wider">Metrics and status at a
                        glance</p>
                </div>
                <div class="flex-1 flex justify-end gap-3">
                </div>
            </div>

            <!-- Nordic Filter Cards (2x2 Grid) -->
            <div class="filter-grid mt-4">
                <!-- Card 1: TERM -->
                <div class="card flex flex-col md:flex-row" style="padding: 0; overflow: hidden; min-height: 56px;">
                    <button class="filter-section btn-theme-short" id="btn-short-term"
                        onclick="app.setFilterCategory('short-term')"
                        style="border-right: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color);">
                        <div class="filter-section-content">
                            <div class="filter-icon-container">
                                <!-- Icon: Hourglass (Bold + Shadow) -->
                                <svg class="filter-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                                    style="filter: drop-shadow(0 3px 2px rgba(59, 130, 246, 0.3));">
                                    <path d="M5 22h14" />
                                    <path d="M5 2h14" />
                                    <path
                                        d="M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22" />
                                    <path d="M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2" />
                                </svg>
                            </div>
                            <div class="filter-content-text">
                                <span class="filter-label-sub">Term</span>
                                <span class="filter-label-main">Short Term</span>
                            </div>
                        </div>
                        <div class="filter-badge-container">
                            <span class="filter-badge-pill" id="count-btn-short">0</span>
                            <span class="filter-badge-pct" id="pct-btn-short">(0%)</span>
                        </div>
                    </button>
                    <button class="filter-section btn-theme-long" id="btn-long-term"
                        onclick="app.setFilterCategory('long-term')">
                        <div class="filter-section-content">
                            <div class="filter-icon-container">
                                <!-- Icon: Bamboo / Trees (Bold + Shadow) -->
                                <svg class="filter-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                                    style="filter: drop-shadow(0 3px 2px rgba(180, 142, 173, 0.3));">
                                    <path d="M7 3v18" />
                                    <path d="M7 8h3" />
                                    <path d="M7 16h3" />
                                    <path d="M17 3v18" />
                                    <path d="M14 8h3" />
                                    <path d="M14 16h3" />
                                    <path d="M12 3v18" />
                                </svg>
                            </div>
                            <div class="filter-content-text">
                                <span class="filter-label-sub">Term</span>
                                <span class="filter-label-main">Long Term</span>
                            </div>
                        </div>
                        <div class="filter-badge-container">
                            <span class="filter-badge-pill" id="count-btn-long">0</span>
                            <span class="filter-badge-pct" id="pct-btn-long">(0%)</span>
                        </div>
                    </button>
                </div>

                <!-- Card 2: TYPE -->
                <div class="card flex flex-col md:flex-row" style="padding: 0; overflow: hidden; min-height: 56px;">
                    <button class="filter-section btn-theme-prof" id="btn-professional"
                        onclick="app.setFilterType('professional')"
                        style="border-right: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color);">
                        <div class="filter-section-content">
                            <div class="filter-icon-container">
                                <!-- Icon: Briefcase (Solid) -->
                                <svg class="filter-icon" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                                    <path
                                        d="M20 7h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v3H4c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2zM10 4h4v3h-4V4z" />
                                </svg>
                            </div>
                            <div class="filter-content-text">
                                <span class="filter-label-sub">Type</span>
                                <span class="filter-label-main">Professional</span>
                            </div>
                        </div>
                        <div class="filter-badge-container">
                            <span class="filter-badge-pill" id="count-btn-prof">0</span>
                            <span class="filter-badge-pct" id="pct-btn-prof">(0%)</span>
                        </div>
                    </button>
                    <button class="filter-section btn-theme-pers" id="btn-personal"
                        onclick="app.setFilterType('personal')">
                        <div class="filter-section-content">
                            <div class="filter-icon-container">
                                <!-- Icon: Home (Solid) -->
                                <svg class="filter-icon" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                                </svg>
                            </div>
                            <div class="filter-content-text">
                                <span class="filter-label-sub">Type</span>
                                <span class="filter-label-main">Personal</span>
                            </div>
                        </div>
                        <div class="filter-badge-container">
                            <span class="filter-badge-pill" id="count-btn-pers">0</span>
                            <span class="filter-badge-pct" id="pct-btn-pers">(0%)</span>
                        </div>
                    </button>
                </div>

                <!-- Card 3: ALL / OVERVIEW -->
                <div class="card flex" style="padding: 0; overflow: hidden; min-height: 80px;">
                    <button class="filter-section btn-theme-all active" id="btn-all" onclick="app.resetFilters()">
                        <div class="filter-section-content">
                            <div class="filter-icon-container">
                                <svg class="filter-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <rect x="3" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="14" width="7" height="7"></rect>
                                    <rect x="3" y="14" width="7" height="7"></rect>
                                </svg>
                            </div>
                            <div class="filter-content-text">
                                <span class="filter-label-sub">Overview</span>
                                <span class="filter-label-main">All Goals</span>
                            </div>
                        </div>
                        <div class="filter-badge-container">
                            <span class="filter-badge-pill" id="count-btn-all">0</span>
                            <span class="filter-badge-pct">(100%)</span>
                        </div>
                    </button>
                </div>

                <!-- Card 4: STATUS -->
                <div class="card flex flex-col md:flex-row" style="padding: 0; overflow: hidden; min-height: 80px;">
                    <button class="filter-section btn-theme-todo" id="btn-status-not-started"
                        onclick="app.setFilterStatus('not-started')"
                        style="border-right: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color);">
                        <div class="filter-section-content">
                            <div class="filter-icon-container">
                                <svg class="filter-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect width="18" height="18" x="3" y="3" rx="2" />
                                </svg>
                            </div>
                            <div class="filter-content-text">

                                <span class="filter-label-main">To Do</span>
                            </div>
                        </div>
                        <div class="filter-badge-container">
                            <span class="filter-badge-pill" id="count-btn-todo">0</span>
                            <span class="filter-badge-pct" id="pct-btn-todo">(0%)</span>
                        </div>
                    </button>
                    <button class="filter-section btn-theme-doing" id="btn-status-in-progress"
                        onclick="app.setFilterStatus('in-progress')"
                        style="border-right: 1px solid var(--border-color)">
                        <div class="filter-section-content">
                            <div class="filter-icon-container">
                                <svg class="filter-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <polyline points="12 6 12 12 16 14"></polyline>
                                </svg>
                            </div>
                            <div class="filter-content-text">

                                <span class="filter-label-main">In Progress</span>
                            </div>
                        </div>
                        <div class="filter-badge-container">
                            <span class="filter-badge-pill" id="count-btn-doing">0</span>
                            <span class="filter-badge-pct" id="pct-btn-doing">(0%)</span>
                        </div>
                    </button>
                    <button class="filter-section btn-theme-done" id="btn-status-completed"
                        onclick="app.setFilterStatus('completed')" style="border-right: 1px solid var(--border-color)">
                        <div class="filter-section-content">
                            <div class="filter-icon-container">
                                <svg class="filter-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                </svg>
                            </div>
                            <div class="filter-content-text">

                                <span class="filter-label-main">Completed</span>
                            </div>
                        </div>
                        <div class="filter-badge-container">
                            <span class="filter-badge-pill" id="count-btn-done">0</span>
                            <span class="filter-badge-pct" id="pct-btn-done">(0%)</span>
                        </div>
                    </button>
                    <button class="filter-section btn-theme-overdue" id="btn-overdue"
                        onclick="app.setFilterStatus('overdue')" style="border-right: 1px solid var(--border-color)">
                        <div class="filter-section-content">
                            <div class="filter-icon-container">
                                <svg class="filter-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
                                    <path d="M3 3v5h5" />
                                    <path d="M12 7v5l4 2" />
                                </svg>
                            </div>
                            <div class="filter-content-text">
                                <span class="filter-label-sub">Attention</span>
                                <span class="filter-label-main">Overdue</span>
                            </div>
                        </div>
                        <div class="filter-badge-container">
                            <span class="filter-badge-pill" id="count-btn-overdue">0</span>
                            <span class="filter-badge-pct" id="pct-btn-overdue">(0%)</span>
                        </div>
                    </button>
                    <button class="filter-section btn-theme-block" id="btn-status-blocked"
                        onclick="app.setFilterStatus('blocked')">
                        <div class="filter-section-content">
                            <div class="filter-icon-container">
                                <svg class="filter-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                                    style="filter: drop-shadow(0 3px 2px rgba(239, 68, 68, 0.3));">
                                    <circle cx="12" cy="12" r="10" />
                                    <path d="m4.9 4.9 14.2 14.2" />
                                </svg>
                            </div>
                            <div class="filter-content-text">

                                <span class="filter-label-main">Blocked</span>
                            </div>
                        </div>
                        <div class="filter-badge-container">
                            <span class="filter-badge-pill" id="count-btn-blocked">0</span>
                            <span class="filter-badge-pct" id="pct-btn-blocked">(0%)</span>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Toolbar: Search, Sort, Status -->
            <div class="card premium-toolbar mt-4" style="padding: 1rem;">
                <div class="flex gap-4 items-center mb-3">
                    <div class="results-counter" id="results-counter">
                        Showing <span>0</span> of <span>0</span> goals
                    </div>
                </div>
                <div class="flex gap-3 items-center">
                    <div class="search-container">
                        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input type="text" id="filter-search" class="search-input" placeholder="Search goals..."
                            oninput="app.updateFilters()">
                        <div class="btn-clear-search"
                            onclick="document.getElementById('filter-search').value=''; app.updateFilters();">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </div>
                    </div>

                    <div class="premium-select-wrapper">
                        <svg class="dropdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
                            <line x1="4" y1="22" x2="4" y2="15"></line>
                        </svg>
                        <select id="filter-status" class="premium-select" onchange="app.updateFilters()">
                            <option value="all">All Status</option>
                            <option value="not-started">To Do</option>
                            <option value="in-progress">In Progress</option>
                            <option value="completed">Completed</option>
                            <option value="blocked">Blocked</option>
                            <option value="overdue">Overdue</option>
                        </select>
                        <svg class="select-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>

                    <div class="premium-select-wrapper">
                        <svg class="dropdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="21" y1="6" x2="3" y2="6"></line>
                            <line x1="15" y1="12" x2="3" y2="12"></line>
                            <line x1="9" y1="18" x2="3" y2="18"></line>
                        </svg>
                        <select id="sort-by" class="premium-select" onchange="app.updateFilters()">
                            <option value="priority-desc">Priority (High to Low)</option>
                            <option value="priority-asc">Priority (Low to High)</option>
                            <option value="end-asc">Deadline (Earliest)</option>
                            <option value="end-desc">Deadline (Latest)</option>
                        </select>
                        <svg class="select-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>

                    <button class="btn btn-secondary h-[44px] px-6" onclick="app.resetFilters()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M23 4v6h-6"></path>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                        </svg>
                        Reset
                    </button>
                </div>
                <!-- Hidden inputs to track state of card filters -->
                <input type="hidden" id="filter-category" value="all">
                <input type="hidden" id="filter-type" value="all">
            </div>

            <!-- Goals Lists -->
            <div class="grid grid-cols-2 mt-4">
                <div>
                    <div class="goal-group-title">
                        <h3>Short Term Goals</h3>
                        <span class="text-sm" id="count-short">0</span>
                    </div>
                    <div id="list-short-term"></div>
                </div>
                <div>
                    <div class="goal-group-title">
                        <h3>Long Term Goals</h3>
                        <span class="text-sm" id="count-long">0</span>
                    </div>
                    <div id="list-long-term"></div>
                </div>
            </div>
        </section>

        <!-- PAGE BOARD -->
        <section id="page-board" class="page">
            <div class="header-standard mb-6">
                <!-- Icon Trigger on Left -->
                <div class="flex-1">
                    <div class="info-tooltip-wrapper" onmouseenter="app.resetPopover(event)">
                        <div class="icon-premium icon-blue" title="How to use Board">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="7" height="7"></rect>
                                <rect x="14" y="3" width="7" height="7"></rect>
                                <rect x="14" y="14" width="7" height="7"></rect>
                                <rect x="3" y="14" width="7" height="7"></rect>
                            </svg>
                        </div>
                        <!-- Popover Content -->
                        <div class="info-popover text-left">
                            <div
                                class="flex justify-between items-center mb-4 border-b border-slate-100 dark:border-slate-700 pb-2">
                                <h3 class="text-xs font-bold uppercase tracking-widest text-primary">Board Guide</h3>
                                <button onclick="app.closePopover(event)"
                                    class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 p-1">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-4 text-xs text-slate-600 dark:text-slate-300">
                                <div>
                                    <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">1. Workflow</h4>
                                    <p>Move cards right as you progress: <span class="font-semibold text-blue-500">To Do
                                             In Progress  Done</span>.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">2. Views</h4>
                                    <p><span class="font-semibold text-primary">Sprint View</span> focuses on Short
                                        Term. <span class="font-semibold text-secondary">All Goals</span> shows
                                        everything.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">3. Actions</h4>
                                    <p>Drag to move. Click to edit. Resize columns with slider.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex-none text-center px-4">
                    <h2 class="text-2xl font-bold text-slate-800 dark:text-white">Kanban Board</h2>
                    <p class="text-xs text-secondary font-medium uppercase tracking-wider mt-1">Visualize your workflow
                    </p>
                </div>

                <div class="flex-1 flex gap-3 items-center justify-end">
                    <div class="board-controls bg-white dark:bg-slate-800 p-2 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm transition-all hover:bg-slate-50 dark:hover:bg-slate-700 hover:scale-105 active:scale-95"
                        title="Adjust Column Width">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" class="text-secondary">
                            <path d="M15 3h6v18h-6M10 17l5-5-5-5M13.8 12H3" />
                        </svg>
                        <input type="range" class="width-slider" min="200" max="600" value="300"
                            oninput="app.updateColumnWidth(this.value)">
                    </div>
                    <div class="h-6 w-px bg-slate-200 dark:bg-slate-700 mx-1"></div>
                    <button class="btn-premium-action btn-blue-hover"
                        onclick="app.setFilterCategory('short-term'); app.renderBoard()">Sprint View</button>
                    <button class="btn-premium-action btn-blue-hover"
                        onclick="app.setFilterCategory('all'); app.renderBoard()">All Goals</button>
                </div>
            </div>

            <!-- Board Container -->
            <div id="kanban-container" class="kanban-board-container custom-scrollbar">
                <!-- Columns injected by JS -->
            </div>

            <!-- Trash Zone -->
            <div class="trash-zone" id="board-trash-zone" ondragover="app.handleDragOverTrash(event)"
                ondragleave="app.handleDragLeaveTrash(event)" ondrop="app.handleDropTrash(event)">
                <span class="flex items-center gap-2">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                    Drop to Delete
                </span>
            </div>
        </section>

        <!-- PAGE B: ENTRY & TRACKING -->
        <section id="page-tracking" class="page">

            <!-- Standardized 3-Column Header: ABOVE the line (tabs) -->
            <div class="header-standard">
                <div class="flex-1 flex items-center gap-6">
                    <div class="info-tooltip-wrapper" onmouseenter="app.resetPopover(event)">
                        <div class="icon-premium icon-emerald" title="How to use Archive">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
                            </svg>
                        </div>
                        <!-- Popover Content -->
                        <div class="info-popover text-left">
                            <div
                                class="flex justify-between items-center mb-4 border-b border-slate-100 dark:border-slate-700 pb-2">
                                <h3 class="text-xs font-bold uppercase tracking-widest text-emerald-500">Archive Guide
                                </h3>
                                <button onclick="app.closePopover(event)"
                                    class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 p-1">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-4 text-xs text-slate-600 dark:text-slate-300">
                                <div>
                                    <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">1. Central Archive
                                    </h4>
                                    <p>A searchable database of every personal and professional target.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">2. Data Portability
                                    </h4>
                                    <p>Export your strategy for backup or import JSON files to sync devices.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">3. Management</h4>
                                    <p>Batch edit, duplicate recurring tasks, or transition goal statuses.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Compact Tabs integrated in Header -->
                    <div class="flex items-center gap-2">
                        <button class="tab-btn-mini" data-tab="tab-list" onclick="app.setTrackingTab('tab-list')">Goals
                            List</button>
                        <button class="tab-btn-mini" data-tab="tab-add" onclick="app.setTrackingTab('tab-add')">Add /
                            Edit Goal</button>
                    </div>
                </div>

                <div class="flex-none text-center px-4">
                    <h2 class="text-2xl font-bold text-emerald-500 dark:text-emerald-400">Goals & Tasks Center</h2>
                    <p class="text-sm text-secondary font-medium uppercase tracking-wider">Complete archive of your
                        personal and professional targets</p>
                </div>

                <!-- Standard Blue Hover Actions -->
                <div class="flex-1 flex items-center justify-end gap-3">
                    <button class="btn-premium-action btn-blue-hover" onclick="DataService.exportData()"
                        title="Export Data">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Export
                    </button>
                    <input type="file" id="import-file" style="display: none;" onchange="DataService.importData(this)">
                    <button class="btn-premium-action btn-blue-hover"
                        onclick="document.getElementById('import-file').click()" title="Import Data">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        Import
                    </button>
                </div>
            </div>



            <!-- TAB 2: Add / Edit Goal -->
            <div id="tab-add" class="tab-panel">
                <div class="card bg-white dark:bg-slate-800 border-none shadow-xl">
                    <form id="goal-form" onsubmit="app.handleFormSubmit(event)">
                        <input type="hidden" id="goal-id">

                        <div class="form-group">
                            <label>Title *</label>
                            <input type="text" id="goal-title" required placeholder="e.g., Learn to Play Piano">
                        </div>

                        <div class="form-group">
                            <label class="mb-2 block font-semibold text-xs text-secondary uppercase">Properties</label>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                                <div class="w-full">
                                    <label class="text-xs mb-1 block">Category</label>
                                    <select id="goal-category" class="w-full">
                                        <option value="short-term">Short-term</option>
                                        <option value="long-term">Long-term</option>
                                    </select>
                                </div>
                                <div class="w-full">
                                    <label class="text-xs mb-1 block">Type</label>
                                    <select id="goal-type" class="w-full">
                                        <option value="personal">Personal</option>
                                        <option value="professional">Professional</option>
                                    </select>
                                </div>
                                <div class="w-full">
                                    <label class="text-xs mb-1 block">Priority</label>
                                    <select id="goal-priority" class="w-full">
                                        <option value="low">Low</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                </div>
                                <div class="w-full">
                                    <label class="text-xs mb-1 block">Status</label>
                                    <select id="goal-status" class="w-full">
                                        <option value="not-started" selected>To Do</option>
                                        <option value="in-progress">In Progress</option>
                                        <option value="completed">Completed</option>
                                        <option value="blocked">Blocked</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Timespan</label>
                            <div class="flex flex-col md:flex-row gap-2">
                                <div class="w-full">
                                    <label class="text-xs">Start Time</label>
                                    <input type="datetime-local" id="goal-start">
                                </div>
                                <div class="w-full">
                                    <label class="text-xs">Target End Time</label>
                                    <input type="datetime-local" id="goal-end">
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Dependencies</label>
                            <div id="goal-dependencies-container"
                                class="border rounded p-2 max-h-40 overflow-y-auto bg-white dark:bg-slate-900 custom-scrollbar">
                                <div class="text-xs text-secondary italic p-1">No other goals available.</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Notes</label>
                            <textarea id="goal-notes" placeholder="Details about this goal..."></textarea>
                        </div>

                        <div class="form-group mt-4 flex gap-2">
                            <button type="submit" class="btn btn-primary flex-1">Save Goal</button>
                            <button type="button" class="btn btn-secondary" onclick="app.resetForm()">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- TAB 3: Goals List -->
            <div id="tab-list" class="tab-panel">
                <div class="card">
                    <div style="overflow-x: auto;">
                        <table class="goal-table">
                            <thead>
                                <tr>
                                    <th>Goal</th>
                                    <th>Category</th>
                                    <th>Type</th>
                                    <th>Priority</th>
                                    <th>Deadline</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                                <tr class="filter-row">
                                    <th style="padding-top: 0; padding-bottom: 8px;"></th>
                                    <th style="padding-top: 0; padding-bottom: 8px;">
                                        <select id="t-filter-category" class="table-select-filter"
                                            onchange="app.renderGoalsTable()">
                                            <option value="all">All</option>
                                        </select>
                                    </th>
                                    <th style="padding-top: 0; padding-bottom: 8px;">
                                        <select id="t-filter-type" class="table-select-filter"
                                            onchange="app.renderGoalsTable()">
                                            <option value="all">All</option>
                                        </select>
                                    </th>
                                    <th style="padding-top: 0; padding-bottom: 8px;">
                                        <select id="t-filter-priority" class="table-select-filter"
                                            onchange="app.renderGoalsTable()">
                                            <option value="all">All</option>
                                        </select>
                                    </th>
                                    <th style="padding-top: 0; padding-bottom: 8px;"></th>
                                    <th style="padding-top: 0; padding-bottom: 8px;">
                                        <select id="t-filter-status" class="table-select-filter"
                                            onchange="app.renderGoalsTable()">
                                            <option value="all">All</option>
                                        </select>
                                    </th>
                                    <th style="padding-top: 0; padding-bottom: 8px;"></th>
                                </tr>
                            </thead>
                            <tbody id="goals-table-body">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- PAGE: CUSTOMIZE -->
        <section id="page-customize" class="page">
            <!-- 3-Column Header for Perfect Centering -->
            <div class="header-standard mb-6">
                <!-- Left Section: Info Trigger -->
                <div class="flex-1">
                    <div class="info-tooltip-wrapper" onmouseenter="app.resetPopover(event)">
                        <div class="icon-premium icon-blue" title="How to use Customizer">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 20h9"></path>
                                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                            </svg>
                        </div>
                        <!-- Popover Content -->
                        <div class="info-popover text-left">
                            <div
                                class="flex justify-between items-center mb-4 border-b border-slate-100 dark:border-slate-700 pb-2">
                                <h3 class="text-xs font-bold uppercase tracking-widest text-primary">Design Guide</h3>
                                <button onclick="app.closePopover(event)"
                                    class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 p-1">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-4 text-xs text-slate-600 dark:text-slate-300">
                                <div>
                                    <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">1. Branding</h4>
                                    <p>Overwrite the Master Title and Subline to match your personal brand.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">2. Visual DNA</h4>
                                    <p>Customize global colors, fonts, and icon sets for a unique aesthetic.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">3. Layout Mastery</h4>
                                    <p>Adjust dashboard widths per page or globally for optimal data density.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Center Section: Title -->
                <div class="flex-none text-center px-4">
                    <h2 class="text-2xl font-bold text-slate-800 dark:text-white m-0">Dashboard Customization</h2>
                    <p class="text-sm text-secondary font-medium uppercase tracking-wider">Refine your visual
                        environment</p>
                </div>

                <!-- Right Section: Actions -->
                <div class="flex-1 flex items-center justify-end gap-4">
                    <button class="btn-premium-action btn-blue-hover" onclick="app.saveSettings()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                        Save Master Design
                    </button>
                    <button class="btn-premium-action btn-red-hover" onclick="app.resetSettings()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 6h18"></path>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                            </path>
                        </svg>
                        Reset Defaults
                    </button>
                </div>
            </div>

            <div class="card mb-4 min-w-[320px]">
                <!-- Old Header Block Removed -->

                <div class="grid grid-cols-1 gap-10">
                    <!-- Column 1: Main Title Styling -->
                    <div class="custom-property-panel">
                        <h4
                            class="text-sm font-bold text-slate-500 uppercase tracking-widest mb-6 border-b border-slate-200 dark:border-slate-700 pb-2">
                            Primary Title Styling</h4>

                        <!-- Content -->
                        <div class="custom-item mb-6">
                            <label>Content</label>
                            <input type="text" id="setting-title" placeholder="e.g. GoalDash" class="dr-input">
                        </div>

                        <!-- Toolbar -->
                        <div class="custom-property-toolbar">
                            <!-- Font -->
                            <div class="custom-item flex-[2] col-span-2">
                                <label>Font</label>
                                <select id="setting-font" class="dr-input">
                                    <option value="Inter, sans-serif">Inter</option>
                                    <option value="'Segoe UI', Roboto, sans-serif">System UI</option>
                                    <option value="'Playfair Display', serif">Playfair Display</option>
                                    <option value="'Courier New', monospace">Courier New</option>
                                    <option value="cursive">Handwritten</option>
                                </select>
                            </div>
                            <!-- Weight -->
                            <div class="custom-item">
                                <label>Weight</label>
                                <select id="setting-weight" class="dr-input px-2">
                                    <option value="300">Light</option>
                                    <option value="normal">Regular</option>
                                    <option value="bold">Bold</option>
                                    <option value="900">Black</option>
                                </select>
                            </div>
                            <!-- Size -->
                            <div class="custom-item">
                                <label>Size</label>
                                <select id="setting-size" class="dr-input px-2">
                                    <option value="1.5rem">Small</option>
                                    <option value="2.5rem" selected>Medium</option>
                                    <option value="3.5rem">Large</option>
                                    <option value="4.5rem">X-Large</option>
                                </select>
                            </div>
                            <!-- Case -->
                            <div class="custom-item">
                                <label>Case</label>
                                <select id="setting-case" class="dr-input px-2">
                                    <option value="none">Default</option>
                                    <option value="uppercase">Upper</option>
                                    <option value="lowercase">Lower</option>
                                    <option value="capitalize">Title</option>
                                </select>
                            </div>
                            <!-- Tracking -->
                            <div class="custom-item">
                                <label>Tracking</label>
                                <select id="setting-spacing" class="dr-input px-2">
                                    <option value="-0.03em">Tight</option>
                                    <option value="normal">Default</option>
                                    <option value="0.05em">Wide</option>
                                    <option value="0.1em">Widest</option>
                                </select>
                            </div>
                            <!-- Style -->
                            <div class="custom-item items-center justify-end h-full">
                                <label class="mb-[2px]">Style</label>
                                <label class="style-toggle-btn" title="Italic">
                                    <input type="checkbox" id="setting-italic" class="hidden peer">
                                    <span
                                        class="text-base font-serif italic text-slate-400 peer-checked:text-blue-500 peer-checked:font-bold">I</span>
                                </label>
                            </div>
                            <!-- Color -->
                            <div class="custom-item items-end justify-end h-full">
                                <label class="mb-[2px]">Color</label>
                                <div class="color-swatch-container">
                                    <input type="color" id="setting-color"
                                        class="absolute inset-0 w-[150%] h-[150%] -top-[25%] -left-[25%] cursor-pointer p-0 border-0 opacity-0 z-10"
                                        value="#0d9488"
                                        oninput="document.getElementById('setting-color-preview').style.backgroundColor = this.value">
                                    <div id="setting-color-preview" class="w-full h-full transition-colors"
                                        style="background-color: #0d9488;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Column 2: Motto Styling -->
                    <div class="custom-property-panel">
                        <h4
                            class="text-sm font-bold text-slate-500 uppercase tracking-widest mb-6 border-b border-slate-200 dark:border-slate-700 pb-2">
                            Motto / Subtitle Styling</h4>

                        <!-- Content -->
                        <div class="custom-item mb-6">
                            <label>Content</label>
                            <input type="text" id="setting-subtitle" placeholder="e.g. 2026 Vision" class="dr-input">
                        </div>

                        <!-- Toolbar -->
                        <div class="custom-property-toolbar">
                            <!-- Font -->
                            <div class="custom-item flex-[2] col-span-2">
                                <label>Font</label>
                                <select id="setting-sub-font" class="dr-input">
                                    <option value="Inter, sans-serif">Inter</option>
                                    <option value="'Segoe UI', Roboto, sans-serif">System UI</option>
                                    <option value="'Playfair Display', serif">Playfair Display</option>
                                    <option value="'Courier New', monospace">Courier New</option>
                                    <option value="cursive">Handwritten</option>
                                </select>
                            </div>
                            <!-- Weight -->
                            <div class="custom-item">
                                <label>Weight</label>
                                <select id="setting-sub-weight" class="dr-input px-2">
                                    <option value="300">Light</option>
                                    <option value="normal">Regular</option>
                                    <option value="bold">Bold</option>
                                </select>
                            </div>
                            <!-- Size -->
                            <div class="custom-item">
                                <label>Size</label>
                                <select id="setting-sub-size" class="dr-input px-2">
                                    <option value="0.8rem">Small</option>
                                    <option value="1.1rem" selected>Medium</option>
                                    <option value="1.5rem">Large</option>
                                    <option value="2rem">X-Large</option>
                                </select>
                            </div>
                            <!-- Case -->
                            <div class="custom-item">
                                <label>Case</label>
                                <select id="setting-sub-case" class="dr-input px-2">
                                    <option value="none">Default</option>
                                    <option value="uppercase">Upper</option>
                                    <option value="lowercase">Lower</option>
                                    <option value="capitalize">Title</option>
                                </select>
                            </div>
                            <!-- Tracking -->
                            <div class="custom-item">
                                <label>Tracking</label>
                                <select id="setting-sub-spacing" class="dr-input px-2">
                                    <option value="normal">Default</option>
                                    <option value="0.05em">Wide</option>
                                    <option value="0.1em">Widest</option>
                                    <option value="-0.03em">Tight</option>
                                </select>
                            </div>
                            <!-- Style -->
                            <div class="custom-item items-center justify-end h-full">
                                <label class="mb-[2px]">Style</label>
                                <label class="style-toggle-btn" title="Italic">
                                    <input type="checkbox" id="setting-sub-italic" class="hidden peer">
                                    <span
                                        class="text-base font-serif italic text-slate-400 peer-checked:text-blue-500 peer-checked:font-bold">I</span>
                                </label>
                            </div>
                            <!-- Color -->
                            <div class="custom-item items-end justify-end h-full">
                                <label class="mb-[2px]">Color</label>
                                <div class="color-swatch-container">
                                    <input type="color" id="setting-sub-color"
                                        class="absolute inset-0 w-[150%] h-[150%] -top-[25%] -left-[25%] cursor-pointer p-0 border-0 opacity-0 z-10"
                                        value="#64748b"
                                        onchange="this.nextElementSibling.style.backgroundColor = this.value">
                                    <div id="setting-sub-color-preview" class="w-full h-full transition-colors"
                                        style="background-color: #64748b;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Column 3: Date & Time Styling -->
                    <div class="custom-property-panel">
                        <h4
                            class="text-sm font-bold text-slate-500 uppercase tracking-widest mb-6 border-b border-slate-200 dark:border-slate-700 pb-2">
                            Date Styling
                        </h4>

                        <!-- Date Toolbar -->
                        <div class="custom-property-toolbar mb-6">
                            <!-- Date Font -->
                            <div class="custom-item flex-[2] col-span-2">
                                <label>Font</label>
                                <select id="setting-date-font" class="dr-input">
                                    <option value="inherit">Inherit</option>
                                    <option value="Inter, sans-serif">Inter</option>
                                    <option value="'Courier New', monospace">Courier New</option>
                                    <option value="'Playfair Display', serif">Playfair Display</option>
                                </select>
                            </div>
                            <!-- Date Size -->
                            <div class="custom-item flex-[1]">
                                <label>Size</label>
                                <select id="setting-date-size" class="dr-input">
                                    <option value="0.8">Small</option>
                                    <option value="1">Normal</option>
                                    <option value="1.2">Large</option>
                                    <option value="1.5">XL</option>
                                </select>
                            </div>
                            <!-- Date Color -->
                            <div class="custom-item flex-[1] items-end justify-end h-full">
                                <label class="mb-[2px]">Color</label>
                                <div class="color-swatch-container">
                                    <input type="color" id="setting-date-color"
                                        class="absolute inset-0 w-[150%] h-[150%] -top-[25%] -left-[25%] cursor-pointer p-0 border-0 opacity-0 z-10"
                                        value="#64748b"
                                        oninput="document.getElementById('preview-date-color').style.backgroundColor = this.value">
                                    <div id="preview-date-color" class="w-full h-full transition-colors"
                                        style="background-color: var(--text-secondary);"></div>
                                </div>
                            </div>
                        </div>
                        <!-- Date Format Row -->
                        <div class="mb-6">
                            <label class="text-xs font-semibold text-secondary uppercase mb-1 block">Format</label>
                            <select id="setting-dt-format" class="dr-input w-full">
                                <option value="full">Full (Friday, January 9, 2026)</option>
                                <option value="long">Long (January 9, 2026)</option>
                                <option value="medium">Medium (Jan 9, 2026)</option>
                                <option value="short">Short (1/9/26)</option>
                            </select>
                        </div>

                        <!-- Time Styling Header -->
                        <h4
                            class="text-sm font-bold text-slate-500 uppercase tracking-widest mt-6 mb-4 border-b border-slate-200 dark:border-slate-700 pb-2">
                            Time Styling
                        </h4>

                        <!-- Time Toolbar -->
                        <div class="custom-property-toolbar mb-4">
                            <!-- Time Font -->
                            <div class="custom-item flex-[2] col-span-2">
                                <label>Font</label>
                                <select id="setting-time-font" class="dr-input">
                                    <option value="inherit">Inherit</option>
                                    <option value="Inter, sans-serif">Inter</option>
                                    <option value="'Courier New', monospace">Courier New</option>
                                    <option value="'Playfair Display', serif">Playfair Display</option>
                                </select>
                            </div>
                            <!-- Time Size -->
                            <div class="custom-item flex-[1]">
                                <label>Size</label>
                                <select id="setting-time-size" class="dr-input">
                                    <option value="0.8">Small</option>
                                    <option value="1">Normal</option>
                                    <option value="1.2">Large</option>
                                    <option value="1.5">XL</option>
                                </select>
                            </div>
                            <!-- Seconds Toggle -->
                            <div class="custom-item flex-[1] items-center justify-center">
                                <label class="mb-2">Sec</label>
                                <button class="style-toggle-btn" id="setting-dt-seconds"
                                    onclick="this.classList.toggle('active'); this.textContent = this.classList.contains('active') ? 'On' : 'Off'">
                                    Off
                                </button>
                            </div>
                            <!-- Time Color -->
                            <div class="custom-item flex-[1] items-end justify-end h-full">
                                <label class="mb-[2px]">Color</label>
                                <div class="color-swatch-container">
                                    <input type="color" id="setting-time-color"
                                        class="absolute inset-0 w-[150%] h-[150%] -top-[25%] -left-[25%] cursor-pointer p-0 border-0 opacity-0 z-10"
                                        value="#000000"
                                        oninput="document.getElementById('preview-time-color').style.backgroundColor = this.value">
                                    <div id="preview-time-color" class="w-full h-full transition-colors"
                                        style="background-color: var(--text-primary);"></div>
                                </div>
                            </div>
                        </div>
                        <!-- Time Format Row -->
                        <div>
                            <label class="text-xs font-semibold text-secondary uppercase mb-1 block">Format</label>
                            <select id="setting-dt-time-format" class="dr-input w-full">
                                <option value="12">12-Hour (09:41 PM)</option>
                                <option value="24">24-Hour (21:41)</option>
                            </select>
                        </div>

                        <!-- Status Icons Section -->
                        <h4
                            class="text-sm font-bold text-slate-500 uppercase tracking-widest mt-6 mb-4 border-b border-slate-200 dark:border-slate-700 pb-2">
                            Status Icons
                        </h4>

                        <!-- Target Selector -->
                        <div class="mb-4">
                            <label class="text-xs font-semibold text-secondary uppercase mb-1 block">Customize Icon
                                For:</label>
                            <select id="icon-target-select" class="dr-input w-full"
                                onchange="app.renderIconPickerState()">
                                <option value="todo">To Do</option>
                                <option value="inProgress" selected>In Progress</option>
                                <option value="completed">Completed</option>
                                <option value="blocked">Blocked</option>
                                <option value="overdue">Overdue</option>
                            </select>
                        </div>

                        <div class="grid grid-cols-6 md:grid-cols-12 gap-1 mb-4" id="icon-picker-container">
                            <!-- Standard Icons -->
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="gears" onclick="app.selectIcon('gears')" title="Settings">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M14 9a2 2 0 0 1-2 2H6l-4 4 4 4h6a2 2 0 0 1 2 2v1h5v-5a2 2 0 0 1 2-2h-3" />
                                    <path d="M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z" opacity="0.5" />
                                    <path d="M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" />
                                    <path
                                        d="M12 2v2m0 16v2m9-9h-2M5 12H3m14.5-4.5-1.5 1.5m-10 10-1.5 1.5m0-13 1.5 1.5m10 10 1.5 1.5" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="mid-target" onclick="app.selectIcon('mid-target')" title="Target">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <circle cx="12" cy="12" r="6"></circle>
                                    <circle cx="12" cy="12" r="2"></circle>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="checklist" onclick="app.selectIcon('checklist')" title="Checklist">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 11l3 3L22 4" />
                                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="lightning" onclick="app.selectIcon('lightning')" title="Lightning">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="play" onclick="app.selectIcon('play')" title="Play">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="loader" onclick="app.selectIcon('loader')" title="Loading">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 12a9 9 0 1 1-6.219-8.56" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="rocket" onclick="app.selectIcon('rocket')" title="Rocket">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path
                                        d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z" />
                                    <path
                                        d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z" />
                                    <path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0" />
                                    <path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="tools" onclick="app.selectIcon('tools')" title="Tools">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path
                                        d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="cycling" onclick="app.selectIcon('cycling')" title="Activity">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="5.5" cy="17.5" r="3.5" />
                                    <circle cx="18.5" cy="17.5" r="3.5" />
                                    <path d="M15 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-3 11.5V14l-3-3 4-3 2 3h2" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="trend" onclick="app.selectIcon('trend')" title="Trend">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" />
                                    <polyline points="17 6 23 6 23 12" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="refresh" onclick="app.selectIcon('refresh')" title="Refresh">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" />
                                    <path d="M21 3v5h-5" />
                                    <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" />
                                    <path d="M8 16H3v5" />
                                </svg>
                            </button>

                            <!-- New App Icons -->
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="clock" onclick="app.selectIcon('clock')" title="Overdue">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
                                    <path d="M3 3v5h5" />
                                    <path d="M12 7v5l4 2" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="square" onclick="app.selectIcon('square')" title="Todo">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect width="18" height="18" x="3" y="3" rx="2" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="circle-poly" onclick="app.selectIcon('circle-poly')" title="In Progress">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <polyline points="12 6 12 12 16 14"></polyline>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="check-circle" onclick="app.selectIcon('check-circle')" title="Completed">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="ban-red" onclick="app.selectIcon('ban-red')" title="Blocked">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10" />
                                    <path d="m4.9 4.9 14.2 14.2" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="hourglass" onclick="app.selectIcon('hourglass')" title="Short Term">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M5 22h14" />
                                    <path d="M5 2h14" />
                                    <path
                                        d="M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22" />
                                    <path d="M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="trees" onclick="app.selectIcon('trees')" title="Long Term">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M7 3v18" />
                                    <path d="M7 8h3" />
                                    <path d="M7 16h3" />
                                    <path d="M17 3v18" />
                                    <path d="M14 8h3" />
                                    <path d="M14 16h3" />
                                    <path d="M12 3v18" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="briefcase" onclick="app.selectIcon('briefcase')" title="Professional">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                                    <path
                                        d="M20 7h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v3H4c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2zM10 4h4v3h-4V4z" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="home" onclick="app.selectIcon('home')" title="Personal">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                                </svg>
                            </button>

                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="star" onclick="app.selectIcon('star')" title="Star">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polygon
                                        points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
                                    </polygon>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="lock" onclick="app.selectIcon('lock')" title="Lock">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="ban" onclick="app.selectIcon('ban')" title="Ban">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="alert" onclick="app.selectIcon('alert')" title="Alert">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="8" x2="12" y2="12"></line>
                                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="list" onclick="app.selectIcon('list')" title="List">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="8" y1="6" x2="21" y2="6"></line>
                                    <line x1="8" y1="12" x2="21" y2="12"></line>
                                    <line x1="8" y1="18" x2="21" y2="18"></line>
                                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                                </svg>
                            </button>
                            <!-- Expanded Utility Icons -->
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="user" onclick="app.selectIcon('user')" title="User">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                                    <circle cx="12" cy="7" r="4" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="users" onclick="app.selectIcon('users')" title="Users">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                                    <circle cx="9" cy="7" r="4" />
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="calendar" onclick="app.selectIcon('calendar')" title="Calendar">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                                    <line x1="16" y1="2" x2="16" y2="6" />
                                    <line x1="8" y1="2" x2="8" y2="6" />
                                    <line x1="3" y1="10" x2="21" y2="10" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="mail" onclick="app.selectIcon('mail')" title="Mail">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path
                                        d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
                                    <polyline points="22,6 12,13 2,6" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="heart" onclick="app.selectIcon('heart')" title="Heart">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path
                                        d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="smile" onclick="app.selectIcon('smile')" title="Smile">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10" />
                                    <path d="M8 14s1.5 2 4 2 4-2 4-2" />
                                    <line x1="9" y1="9" x2="9.01" y2="9" />
                                    <line x1="15" y1="9" x2="15.01" y2="9" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="flag" onclick="app.selectIcon('flag')" title="Flag">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z" />
                                    <line x1="4" y1="22" x2="4" y2="15" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="bookmark" onclick="app.selectIcon('bookmark')" title="Bookmark">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="camera" onclick="app.selectIcon('camera')" title="Camera">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path
                                        d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" />
                                    <circle cx="12" cy="13" r="4" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="edit" onclick="app.selectIcon('edit')" title="Edit">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="trash" onclick="app.selectIcon('trash')" title="Trash">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="3 6 5 6 21 6" />
                                    <path
                                        d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="folder" onclick="app.selectIcon('folder')" title="Folder">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path
                                        d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="file" onclick="app.selectIcon('file')" title="File">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z" />
                                    <polyline points="13 2 13 9 20 9" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="image" onclick="app.selectIcon('image')" title="Image">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                                    <circle cx="8.5" cy="8.5" r="1.5" />
                                    <polyline points="21 15 16 10 5 21" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="music" onclick="app.selectIcon('music')" title="Music">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 18V5l12-2v13" />
                                    <circle cx="6" cy="18" r="3" />
                                    <circle cx="18" cy="16" r="3" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-1 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="video" onclick="app.selectIcon('video')" title="Video">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polygon points="23 7 16 12 23 17 23 7" />
                                    <rect x="1" y="5" width="15" height="14" rx="2" ry="2" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="briefcase-case" onclick="app.selectIcon('briefcase-case')" title="Work Case">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                                    <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="code" onclick="app.selectIcon('code')" title="Code">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="16 18 22 12 16 6"></polyline>
                                    <polyline points="8 6 2 12 8 18"></polyline>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="cpu" onclick="app.selectIcon('cpu')" title="CPU">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect>
                                    <rect x="9" y="9" width="6" height="6"></rect>
                                    <line x1="9" y1="1" x2="9" y2="4"></line>
                                    <line x1="15" y1="1" x2="15" y2="4"></line>
                                    <line x1="9" y1="20" x2="9" y2="23"></line>
                                    <line x1="15" y1="20" x2="15" y2="23"></line>
                                    <line x1="20" y1="9" x2="23" y2="9"></line>
                                    <line x1="20" y1="14" x2="23" y2="14"></line>
                                    <line x1="1" y1="9" x2="4" y2="9"></line>
                                    <line x1="1" y1="14" x2="4" y2="14"></line>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="database" onclick="app.selectIcon('database')" title="Database">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                                    <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                                    <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
                                </svg>
                            </button>


                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="edit-3" onclick="app.selectIcon('edit-3')" title="Edit 3">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 20h9"></path>
                                    <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="eye" onclick="app.selectIcon('eye')" title="Eye">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="filter" onclick="app.selectIcon('filter')" title="Filter">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="globe" onclick="app.selectIcon('globe')" title="Globe">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="2" y1="12" x2="22" y2="12"></line>
                                    <path
                                        d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                                    </path>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="grid" onclick="app.selectIcon('grid')" title="Grid">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="14" width="7" height="7"></rect>
                                    <rect x="3" y="14" width="7" height="7"></rect>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="hash" onclick="app.selectIcon('hash')" title="Hash">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="4" y1="9" x2="20" y2="9"></line>
                                    <line x1="4" y1="15" x2="20" y2="15"></line>
                                    <line x1="10" y1="3" x2="8" y2="21"></line>
                                    <line x1="16" y1="3" x2="14" y2="21"></line>
                                </svg>
                            </button>


                            <!-- Additional Icons -->
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="gift" onclick="app.selectIcon('gift')" title="Gift">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="20 12 20 22 4 22 4 12"></polyline>
                                    <rect x="2" y="7" width="20" height="5"></rect>
                                    <line x1="12" y1="22" x2="12" y2="7"></line>
                                    <path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"></path>
                                    <path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"></path>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="chart" onclick="app.selectIcon('chart')" title="Chart">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="18" y1="20" x2="18" y2="10"></line>
                                    <line x1="12" y1="20" x2="12" y2="4"></line>
                                    <line x1="6" y1="20" x2="6" y2="14"></line>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="coffee" onclick="app.selectIcon('coffee')" title="Coffee">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M18 8h1a4 4 0 0 1 0 8h-1"></path>
                                    <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path>
                                    <line x1="6" y1="1" x2="6" y2="4"></line>
                                    <line x1="10" y1="1" x2="10" y2="4"></line>
                                    <line x1="14" y1="1" x2="14" y2="4"></line>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="wifi" onclick="app.selectIcon('wifi')" title="Wifi">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M5 12.55a11 11 0 0 1 14.08 0"></path>
                                    <path d="M1.42 9a16 16 0 0 1 21.16 0"></path>
                                    <path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path>
                                    <line x1="12" y1="20" x2="12.01" y2="20"></line>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="headphones" onclick="app.selectIcon('headphones')" title="Headphones">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
                                    <path
                                        d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z">
                                    </path>
                                </svg>
                            </button>
                            <!-- Restored Icons -->
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="download" onclick="app.selectIcon('download')" title="Download">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="info" onclick="app.selectIcon('info')" title="Information">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="attention-triangle" onclick="app.selectIcon('attention-triangle')"
                                title="Attention Triangle">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="12" y1="8" x2="12" y2="12" />
                                    <line x1="12" y1="16" x2="12.01" y2="16" />
                                    <path
                                        d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                                </svg>
                            </button>
                            <button
                                class="icon-option p-0.5 rounded-sm border border-slate-200 dark:border-slate-700 hover:bg-blue-50 dark:hover:bg-slate-800 flex items-center justify-center transition-all"
                                data-icon="palette" onclick="app.selectIcon('palette')" title="Palette">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="13.5" cy="6.5" r=".5"></circle>
                                    <circle cx="17.5" cy="10.5" r=".5"></circle>
                                    <circle cx="8.5" cy="7.5" r=".5"></circle>
                                    <circle cx="6.5" cy="12.5" r=".5"></circle>
                                    <path
                                        d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10c.55 0 1-.45 1-1 0-.27-.11-.5-.28-.68-.17-.18-.28-.41-.28-.67a1 1 0 0 1 1-1c3 0 8-1.5 8-7.31s-3.58-9.34-9.44-9.34z">
                                    </path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>


                <!-- Column 4: Page Layout Styling -->
                <div class="custom-property-panel">
                    <h4
                        class="text-sm font-bold text-slate-500 uppercase tracking-widest mb-6 border-b border-slate-200 dark:border-slate-700 pb-2">
                        Page Layout
                    </h4>

                    <!-- Layout Toolbar -->
                    <div class="custom-property-toolbar mb-2">
                        <!-- Target Page -->
                        <div class="custom-item flex-[1.5] col-span-2">
                            <label>Target Page</label>
                            <select id="layout-target-page"
                                class="dr-input w-full text-xs p-2 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 outline-none">
                                <option value="global">All Pages (Default)</option>
                                <option value="overview">Overview</option>
                                <option value="tracking">Goals List</option>
                                <option value="board">Board</option>
                                <option value="attention">Attention</option>
                                <option value="calendar">Calendar</option>
                                <option value="customize">Customize</option>
                            </select>
                        </div>
                        <!-- Width -->
                        <div class="custom-item flex-[1]">
                            <label>Width</label>
                            <select onchange="app.handleWidthChange(this.value)"
                                class="dr-input w-full text-xs p-2 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 outline-none">
                                <option value="50%">50%</option>
                                <option value="60%">60%</option>
                                <option value="70%">70%</option>
                                <option value="80%">80%</option>
                                <option value="85%">85%</option>
                                <option value="90%" selected>90% (Rec)</option>
                                <option value="95%">95%</option>
                                <option value="100%">100%</option>
                            </select>
                        </div>
                        <div class="custom-item flex-[0.8] items-end justify-start h-full pb-[2px]">
                            <button onclick="app.setPageWidth('1200px')"
                                class="btn-secondary text-[10px] px-3 py-1 h-[32px] rounded border border-slate-200 dark:border-slate-700 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 transition-all whitespace-nowrap"
                                title="Reset All to Standard">Standard all (Reset)</button>
                        </div>
                    </div>
                </div>

            </div>
            </div>
            </div>
        </section>

        <!-- PAGE C: CALENDAR -->
        <section id="page-calendar" class="page">
            <!-- 3-Column Header for Perfect Centering -->
            <div class="header-standard">
                <div class="flex-1">
                    <div class="info-tooltip-wrapper" onmouseenter="app.resetPopover(event)">
                        <div class="icon-premium icon-blue" title="How to use Calendar">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                                <line x1="16" y1="2" x2="16" y2="6" />
                                <line x1="8" y1="2" x2="8" y2="6" />
                                <line x1="3" y1="10" x2="21" y2="10" />
                            </svg>
                        </div>
                        <!-- Popover Content -->
                        <div class="info-popover text-left">
                            <div
                                class="flex justify-between items-center mb-4 border-b border-slate-100 dark:border-slate-700 pb-2">
                                <h3 class="text-xs font-bold uppercase tracking-widest text-blue-500">Schedule Guide
                                </h3>
                                <button onclick="app.closePopover(event)"
                                    class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 p-1">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-4 text-xs text-slate-600 dark:text-slate-300">
                                <div>
                                    <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">1. Time Allocation
                                    </h4>
                                    <p>Visualize your workload on a timeline to spot resource conflicts early.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">2. Drag & Drop</h4>
                                    <p>Commit unscheduled goals from the sidebar directly onto the calendar grid.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">3. Syncing</h4>
                                    <p>Export ICS files to bring your dashboard goals into Outlook or Google.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex-none text-center px-4">
                    <h2 class="text-2xl font-bold text-blue-500 dark:text-blue-400">Calendar Overview</h2>
                    <p class="text-sm text-secondary font-medium uppercase tracking-wider">Manage your journey on the
                        timeline</p>
                </div>

                <!-- Right Actions -->
                <div class="flex-1 flex items-center justify-end gap-4">
                    <!-- Export Button with Solid Hover -->
                    <button class="btn-premium-action btn-blue-hover" onclick="DataService.exportCalendar()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                            <polyline points="7 10 12 15 17 10" />
                            <line x1="12" y1="15" x2="12" y2="3" />
                        </svg>
                        Export ICS
                    </button>
                </div>
            </div>
            <div class="flex flex-col lg:flex-row gap-6" style="height: calc(100vh - 200px); min-height: 600px;">
                <!-- Calendar Grid (70%) -->
                <div class="card p-4 flex flex-col" style="flex: 7; overflow: hidden;">
                    <div id='calendar' style="flex: 1;"></div>
                </div>

                <!-- Planning Context Panel (30%) -->
                <div class="card p-0 flex flex-col"
                    style="flex: 3; min-width: 300px; display: flex; flex-direction: column; overflow: hidden;">
                    <div class="p-4 border-b bg-slate-50 dark:bg-slate-800/50">
                        <h3 class="font-bold mb-1" id="ctx-title">Unscheduled Goals</h3>
                        <p class="text-xs text-secondary" id="ctx-desc">Drag to calendar to schedule</p>
                    </div>

                    <!-- Dynamic Content Area -->
                    <div id="ctx-content"
                        class="flex-1 overflow-y-auto p-4 custom-scrollbar bg-white dark:bg-[#1e293b]">
                        <!-- Default: Unscheduled List -->
                        <div id="unscheduled-list" class="space-y-2 pb-4"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- PAGE D: ATTENTION / TIMELINE -->
        <section id="page-attention" class="page">
            <!-- 3-Column Header for Perfect Centering -->
            <div class="header-standard">
                <div class="flex-1">
                    <div class="info-tooltip-wrapper" onmouseenter="app.resetPopover(event)">
                        <div class="icon-premium icon-amber" title="View Focus Guide">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="12" y1="8" x2="12" y2="12" />
                                <line x1="12" y1="16" x2="12.01" y2="16" />
                                <path
                                    d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                            </svg>
                        </div>
                        <!-- Popover Content -->
                        <div class="info-popover text-left">
                            <div
                                class="flex justify-between items-center mb-4 border-b border-slate-100 dark:border-slate-700 pb-2">
                                <h3 class="text-xs font-bold uppercase tracking-widest text-amber-500">Focus Guide</h3>
                                <button onclick="app.closePopover(event)"
                                    class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 p-1">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-4 text-xs text-slate-600 dark:text-slate-300">
                                <div>
                                    <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">1. Critical Path</h4>
                                    <p>Dynamic sorting of High Priority and Overdue goals needing action NOW.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">2. Horizontal Focus
                                    </h4>
                                    <p>Analyze progress spread across all strategic categories simultaneously.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-800 dark:text-slate-100 mb-1">3. Bottlenecks</h4>
                                    <p>Quickly identify goals stalled by dependencies or missed deadlines.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex-none text-center px-4">
                    <h2 class="text-2xl font-bold text-amber-500 dark:text-amber-400 m-0">Attention Center</h2>
                    <p class="text-sm text-secondary font-medium uppercase tracking-wider">Focus on your most critical
                        goals across time</p>
                </div>
                <div class="flex-1 flex items-center justify-end gap-4">
                </div>
                <!-- Controls -->
                <div class="flex items-center gap-2 bg-white dark:bg-slate-800 p-2 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm transition-all hover:bg-slate-50 dark:hover:bg-slate-700 hover:scale-105 active:scale-95"
                    title="Adjust Column Width">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        class="text-secondary">
                        <path d="M15 3h6v18h-6M10 17l5-5-5-5M13.8 12H3" />
                    </svg>
                    <input type="range" min="200" max="500" value="320" class="width-slider"
                        oninput="app.updateAttentionColumnWidth(this.value)">
                </div>
            </div>

            <!-- Reusing Kanban Container Class for horizontal layout -->
            <div id="attention-board" class="kanban-board-container">
                <!-- Columns injected by JS -->
            </div>
        </section>
    </main>

    <div id="toast-container"></div>

    <script>
        // --- 1. UTILS & HELPERS ---
        const Utils = {
            generateId: () => 'goal-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),

            formatDate: (isoString) => {
                if (!isoString) return '-';
                return new Date(isoString).toLocaleString([], { dateStyle: 'short', timeStyle: 'short' });
            },

            // Safe clamp
            clamp: (num, min, max) => Math.min(Math.max(num, min), max),

            // Time Diff Helpers
            getTimeDiff: (start, end) => {
                const diff = new Date(end) - new Date(start);
                if (isNaN(diff)) return 0;
                return diff;
            },

            formatDuration: (ms) => {
                if (ms < 0) return 'Overdue';
                if (ms === 0) return '-';
                const hours = Math.floor(ms / (1000 * 60 * 60));
                const days = Math.floor(hours / 24);
                if (days > 0) return `${days}d ${hours % 24}h`;
                return `${hours}h ${Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60))}m`;
            },

            toProperCase: (str) => {
                return str.replace(/\w\S*/g, function (txt) { return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase(); });
            },

            capitalize: (str) => {
                if (!str) return '';
                return str.charAt(0).toUpperCase() + str.slice(1);
            },

            toTitleCase: (s) => {
                if (!s) return '';
                if (s.toLowerCase() === 'not-started') return 'To Do';
                return s.split(/[- ]/).map(w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase()).join(' ');
            },

            toggleDarkMode: () => {
                document.body.classList.toggle('dark');
                localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
            },

            showToast: (msg, type = 'info') => {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;

                let icon = 'i';
                if (type === 'success') icon = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>';
                if (type === 'error') icon = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>';

                toast.innerHTML = `
                    <div class="toast-icon">${icon}</div>
                    <div class="font-medium text-sm">${msg}</div>
                `;

                container.appendChild(toast);
                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateY(10px)';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
        };

        const DataService = {
            pendingImport: null,

            exportData: () => {
                const data = {
                    goals: Store.getAll(),
                    settings: JSON.parse(localStorage.getItem('goalDashSettings') || '{}')
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `goals_backup_${new Date().toISOString().slice(0, 10)}.json`;
                a.click();
                URL.revokeObjectURL(url);
                Utils.showToast('Data exported successfully', 'success');
            },

            exportCalendar: () => {
                const goals = Store.getAll();
                let icsContent = "BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//GoalDash//EN\n";

                goals.forEach(g => {
                    const startStr = g.startTime || g.deadline;
                    if (!startStr) return;

                    const start = new Date(startStr);
                    // Default to 1 hour if no end time, or use Deadline as start
                    const end = g.endTime ? new Date(g.endTime) : new Date(start.getTime() + 3600000);

                    const fmt = (d) => d.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';

                    icsContent += "BEGIN:VEVENT\n";
                    icsContent += `SUMMARY:${g.title}\n`;
                    icsContent += `DTSTART:${fmt(start)}\n`;
                    icsContent += `DTEND:${fmt(end)}\n`;
                    icsContent += `DESCRIPTION:${g.notes || ''} [Category: ${g.category}]\n`;
                    icsContent += "END:VEVENT\n";
                });

                icsContent += "END:VCALENDAR";

                const blob = new Blob([icsContent], { type: 'text/calendar' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `goals_calendar_${new Date().toISOString().slice(0, 10)}.ics`;
                a.click();
                URL.revokeObjectURL(url);
                Utils.showToast('Calendar exported (ICS)', 'success');
            },

            importData: (input) => {
                const file = input.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (!data.goals) throw new Error("No goals found in file");

                        DataService.pendingImport = data;
                        document.getElementById('import-modal').classList.remove('hidden');
                    } catch (err) {
                        Utils.showToast('Invalid JSON file', 'error');
                        console.error(err);
                    }
                };
                reader.readAsText(file);
                input.value = ''; // Reset input
            },

            closeImportModal: () => {
                document.getElementById('import-modal').classList.add('hidden');
                DataService.pendingImport = null;
            },

            confirmImport: (mode) => {
                const data = DataService.pendingImport;
                if (!data) return;

                if (mode === 'replace') {
                    if (data.goals) localStorage.setItem(Store.KEY, JSON.stringify(data.goals));
                    if (data.settings) localStorage.setItem('goalDashSettings', JSON.stringify(data.settings));
                } else if (mode === 'append') {
                    const existingGoals = Store.getAll();
                    const existingIds = new Set(existingGoals.map(g => g.id));

                    const newGoals = data.goals.map(g => {
                        // Regenerate ID if it already exists to avoid collisions
                        if (existingIds.has(g.id)) {
                            return { ...g, id: Utils.generateId() };
                        }
                        return g;
                    });

                    localStorage.setItem(Store.KEY, JSON.stringify([...existingGoals, ...newGoals]));
                }

                DataService.closeImportModal();
                Utils.showToast(`Data successfully ${mode === 'replace' ? 'replaced' : 'appended'}`, 'success');
                setTimeout(() => location.reload(), 1000);
            }
        };

        // --- 2. DATA STORE ---(LocalStorage) ---
        const Store = {
            KEY: 'goals_dashboard_v1',

            getAll: () => {
                const data = localStorage.getItem(Store.KEY);
                return data ? JSON.parse(data) : [];
            },

            saveAll: (goals) => {
                localStorage.setItem(Store.KEY, JSON.stringify(goals));
            },

            add: (goal) => {
                const goals = Store.getAll();
                goals.push(goal);
                Store.saveAll(goals);
            },

            update: (updatedGoal) => {
                let goals = Store.getAll();
                const idx = goals.findIndex(g => g.id === updatedGoal.id);
                if (idx !== -1) {
                    goals[idx] = updatedGoal;
                    Store.saveAll(goals);
                }
            },

            delete: (id) => {
                let goals = Store.getAll();
                goals = goals.filter(g => g.id !== id);
                Store.saveAll(goals);
            },

            clear: () => localStorage.removeItem(Store.KEY),
        };



        // --- 3. APPLICATION LOGIC ---
        class GoalApp {
            constructor() {
                this.goals = [];
                this.currentPage = 'overview';
                this.filters = {
                    search: '',
                    category: 'all',
                    type: 'all',
                    status: 'all',
                    sort: 'priority-desc'
                };

                // Binding "this"
                this.handleFormSubmit = this.handleFormSubmit.bind(this);

                // Global click handler to close menus
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.action-menu-container')) {
                        document.querySelectorAll('[id^="menu-"]').forEach(el => el.classList.add('hidden'));
                    }
                });

                this.init();
            }

            init() {
                // Initialize Data
                this.goals = Store.getAll(); // Corrected from dataStore.loadGoals()

                // Initialize Views
                this.renderOverview();
                this.renderGoalsTable();

                // Load Settings
                this.loadSettings();

                // Apply saved page width
                const savedSettings = JSON.parse(localStorage.getItem('goalDashSettings') || '{}');
                if (savedSettings.pageWidth) {
                    const main = document.querySelector('main');
                    if (main) main.style.maxWidth = savedSettings.pageWidth;
                }

                // Setup Navigation (Placeholder, assuming it will be added later or is implicit)
                // this.setupNavigation(); 

                // Default Tab
                this.setTrackingTab('tab-list');

                // Clock (Placeholder, assuming it will be added later or is implicit)
                // setInterval(() => this.updateClock(), 60000);
                // this.updateClock();

                // Auto-refresh timer for calculations (every 60s)
                setInterval(() => {
                    this.renderAll();
                }, 60000);

                // Start Clock
                this.updateClock();
                setInterval(() => this.updateClock(), 1000);
            }

            updateClock() {
                const now = new Date();
                const dEl = document.getElementById('date-display');
                const tEl = document.getElementById('time-display');
                if (!dEl || !tEl) return;

                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                dEl.textContent = now.toLocaleDateString(undefined, options);

                // Check settings
                const dtFormat = localStorage.getItem('goalDashSettings') ? JSON.parse(localStorage.getItem('goalDashSettings')).dtFormat : 'full';
                const timeFormat = localStorage.getItem('goalDashSettings') ? JSON.parse(localStorage.getItem('goalDashSettings')).dtTimeFormat : '12';

                // Date Formatting
                const dateOptions = {
                    full: { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' },
                    long: { year: 'numeric', month: 'long', day: 'numeric' },
                    medium: { year: 'numeric', month: 'short', day: 'numeric' },
                    short: { year: '2-digit', month: 'numeric', day: 'numeric' }
                };
                dEl.textContent = now.toLocaleDateString(undefined, dateOptions[dtFormat] || dateOptions.full);

                // Time Formatting
                const showSeconds = document.getElementById('setting-dt-seconds')?.classList.contains('active') ?? false;
                const timeOpts = {
                    hour: 'numeric',
                    minute: '2-digit',
                    second: showSeconds ? '2-digit' : undefined,
                    hour12: timeFormat === '12'
                };

                // Fix for 24h needing explicit '2-digit' usually or just default
                if (timeFormat === '24') {
                    timeOpts.hour = '2-digit';
                    timeOpts.hour12 = false;
                }

                tEl.textContent = now.toLocaleTimeString(undefined, timeOpts);
            }

            setTrackingTab(tabId) {
                // Hide all panels
                document.querySelectorAll('.tab-panel').forEach(el => el.classList.remove('active'));

                // Remove active class from buttons
                document.querySelectorAll('.tab-btn, .tab-btn-mini').forEach(btn => btn.classList.remove('active'));

                // Show target panel
                const panel = document.getElementById(tabId);
                if (panel) panel.classList.add('active');

                // Activate button by data attribute
                const btns = document.querySelectorAll(`.tab-btn[data-tab="${tabId}"], .tab-btn-mini[data-tab="${tabId}"]`);
                btns.forEach(btn => btn.classList.add('active'));
            }

            setupEventListeners() {
                // Initial page load handled in HTML by calling app.setPage
            }

            setPage(pageId) {
                this.currentPage = pageId;
                document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));

                document.getElementById(`page-${pageId}`).classList.add('active');

                // Update nav state
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));

                if (pageId === 'overview') {
                    document.querySelector('.nav-btn[onclick*="overview"]').classList.add('active');
                } else if (pageId === 'tracking') {
                    document.querySelector('.nav-btn[onclick*="tracking"]').classList.add('active');
                } else if (pageId === 'customize') {
                    document.querySelector('.nav-btn[onclick*="customize"]').classList.add('active');
                } else if (pageId === 'board') {
                    document.querySelector('.nav-btn[onclick*="board"]').classList.add('active');
                    this.renderBoard();
                } else if (pageId === 'attention') {
                    document.querySelector('.nav-btn[onclick*="attention"]').classList.add('active');
                    this.renderAttention();
                } else if (pageId === 'calendar') {
                    document.getElementById('btn-nav-calendar')?.classList.add('active');
                    this.renderCalendar(); // Explicit render call
                }

                if (pageId !== 'calendar' && pageId !== 'board' && pageId !== 'attention') this.renderAll();

                // Apply Page Specific Width if it exists, else Global, else default
                const settings = JSON.parse(localStorage.getItem('goalDashSettings') || '{}');
                const main = document.querySelector('main');
                if (main) {
                    if (settings.pageWidths && settings.pageWidths[pageId]) {
                        main.style.maxWidth = settings.pageWidths[pageId];
                    } else if (settings.pageWidth) {
                        main.style.maxWidth = settings.pageWidth;
                    } else {
                        // Default
                        main.style.maxWidth = '90%';
                    }
                }
            }

            // --- CALENDAR REDESIGN ---
            initDraggable() {
                const containerEl = document.getElementById('unscheduled-list');
                if (!containerEl || this.draggableInit) return;

                // Initialize Draggable on container
                new FullCalendar.Draggable(containerEl, {
                    itemSelector: '.draggable-item',
                    eventData: (eventEl) => {
                        const id = eventEl.getAttribute('data-id');
                        const goal = this.goals.find(g => g.id === id);
                        if (!goal) return {};

                        // Return event properties for the drop
                        return {
                            id: goal.id,
                            title: goal.title,
                            backgroundColor: 'var(--c-doing)', // default drop color
                            borderColor: 'transparent'
                        };
                    }
                });
                this.draggableInit = true;
            }

            initCalendar() {
                if (this.calendar) return;

                const calendarEl = document.getElementById('calendar');
                if (!calendarEl) return;

                // Ensure FullCalendar Draggable is loaded/shimmed if needed
                // Assuming standard bundle includes interaction

                this.calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'timeGridWeek',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay'
                    },
                    buttonText: {
                        today: 'Today',
                        month: 'Month',
                        week: 'Week',
                        day: 'Day'
                    },
                    height: '100%',
                    editable: true,
                    droppable: true,
                    dayMaxEvents: 2, // Month view limit

                    // Event Handling
                    events: this.getCalendarEvents.bind(this),

                    eventClick: (info) => {
                        // Context Panel: Goal Selected
                        this.renderContextPanel('goal', info.event.id);
                    },
                    dateClick: (info) => {
                        // Context Panel: Date Selected
                        this.renderContextPanel('date', info.dateStr);
                    },
                    eventDrop: (info) => {
                        this.handleEventDrop(info);
                    },
                    eventReceive: (info) => {
                        this.handleEventReceive(info); // Dropped from sidebar
                    },
                    eventResize: (info) => {
                        this.handleEventDrop(info); // Treat resize same as drop (time update)
                    },

                    // Visuals
                    eventContent: (arg) => {
                        // Minimalist ID for CSS targeting
                        return { html: `<div class="fc-event-main-content">${arg.event.title}</div>` };
                    },
                    windowResize: () => {
                        if (this.calendar) this.calendar.updateSize();
                    }
                });

                this.calendar.render();
            }

            handleEventDrop(info) {
                const id = info.event.id;
                const goal = this.goals.find(g => g.id === id);
                if (!goal) return;

                // Update Times
                const start = info.event.start;
                const end = info.event.end || new Date(start.getTime() + 60 * 60 * 1000); // Default 1hr if no end

                // Format to ISO string for storage
                // Note: input type=datetime-local expects YYYY-MM-DDTHH:mm
                // We'll stick to full ISO for storage, format for input later
                goal.startTime = start.toISOString();
                goal.endTime = end.toISOString();

                // Auto-set Status if not started? User choice. Let's keep status manual or logic based.
                // But dragging to calendar implies "planned", so logic remains neutral.

                Store.update(goal);
                Utils.showToast('Goal rescheduled', 'success');
                this.renderContextPanel('goal', id); // Show updated context
            }

            handleEventReceive(info) {
                // Item dropped from sidebar
                const id = info.event.id;
                const goal = this.goals.find(g => g.id === id);
                if (!goal) return;

                // Remove temporary event, we will re-render full calendar from state
                info.event.remove();

                // Update Goal Dates
                const start = info.event.start;
                const end = new Date(start.getTime() + 60 * 60 * 1000); // Default 1h duration

                goal.startTime = start.toISOString();
                goal.endTime = end.toISOString();

                Store.update(goal);
                Utils.showToast('Goal scheduled', 'success');

                this.renderCalendar(); // Re-fetch events and re-render sidebar
                this.renderContextPanel('goal', id);
            }

            getCalendarEvents(fetchInfo, successCallback, failureCallback) {
                const events = this.goals.map(g => {
                    const metrics = this.calculateGoalMetrics(g);

                    // Date Logic: Prefer Start-End range for blocking
                    const startStr = g.startTime || g.deadline;
                    if (!startStr) return null; // Unscheduled

                    let classList = [];
                    // Status Border Classes
                    if (metrics.visualStatus === 'not-started') classList.push('status-border-todo');
                    else if (metrics.visualStatus === 'in-progress') classList.push('status-border-doing');
                    else if (metrics.visualStatus === 'completed') classList.push('status-border-done');
                    else if (metrics.visualStatus === 'blocked') classList.push('status-border-block');

                    // All Day Logic: Force if > 24h
                    let isAllDay = !startStr.includes('T');
                    if (g.startTime && g.endTime) {
                        const start = new Date(g.startTime);
                        const end = new Date(g.endTime);
                        const durationHours = (end - start) / (1000 * 60 * 60);
                        if (durationHours > 24) isAllDay = true;
                    }

                    return {
                        id: g.id,
                        title: g.title,
                        start: startStr,
                        end: g.endTime, // might be undefined
                        allDay: isAllDay,
                        classNames: classList,
                        textColor: 'var(--text-primary)',
                        borderColor: 'transparent' // Handled by CSS
                    };
                }).filter(e => e !== null);

                successCallback(events);
            }

            renderCalendar() {
                // 1. Init Calendar if needed
                if (!this.calendar) this.initCalendar();

                // 2. Render Unscheduled List (for Sidebar)
                this.renderUnscheduledList();

                // 3. Init Draggable
                this.initDraggable();

                // 4. Refetch Calendar Events
                if (this.calendar) this.calendar.refetchEvents();

                // 5. Default Context
                this.renderContextPanel('default');
            }

            renderUnscheduledList() {
                const unscheduled = this.goals.filter(g => !g.startTime && !g.endTime && !g.deadline);
                const listEl = document.getElementById('unscheduled-list');
                if (!listEl) return;

                if (unscheduled.length === 0) {
                    listEl.innerHTML = '<div class="text-xs text-secondary italic">All goals scheduled!</div>';
                    return;
                }

                listEl.innerHTML = unscheduled.map(g => `
                    <div class="draggable-item card p-3 border border-slate-200 dark:border-slate-700 hover:shadow-md cursor-grab bg-white dark:bg-slate-800 transition-all flex justify-between items-center group" data-id="${g.id}">
                        <div class="mr-2 min-w-0">
                            <div class="text-sm font-semibold text-slate-700 dark:text-slate-200">${g.title}</div>
                            <div class="text-[10px] text-secondary flex gap-2">
                                <span class="capitalize">${g.type}</span>
                                <span></span>
                                <span class="capitalize">${g.category}</span>
                            </div>
                        </div>
                        <div class="opacity-0 group-hover:opacity-100 transition-opacity">
                             <span class="text-xs text-slate-400"></span>
                        </div>
                    </div>
                `).join('');
            }

            renderContextPanel(mode, data) {
                const titleEl = document.getElementById('ctx-title');
                const descEl = document.getElementById('ctx-desc');
                const contentEl = document.getElementById('ctx-content');

                if (mode === 'default') {
                    titleEl.textContent = 'Unscheduled Goals';
                    descEl.textContent = 'Drag to calendar to schedule';
                    // Ensure sidebar list is visible
                    contentEl.innerHTML = '<div id="unscheduled-list" class="space-y-2 pb-4"></div>';
                    this.renderUnscheduledList();
                    this.initDraggable(); // Re-bind since innerHTML changed
                } else if (mode === 'date') {
                    titleEl.textContent = new Date(data).toLocaleDateString(undefined, { weekday: 'long', month: 'short', day: 'numeric' });
                    descEl.textContent = 'Day Overview';

                    // Show goals for this day? Or Add New?
                    // Simple implementation: Add New Shortcut
                    contentEl.innerHTML = `
                        <div class="flex flex-col gap-4">
                            <button class="btn btn-primary w-full py-3 flex justify-center items-center gap-2" onclick="app.setPage('tracking'); document.getElementById('goal-start').value='${data}T09:00'">
                                <span>+</span> Add Goal for ${new Date(data).toLocaleDateString()}
                            </button>
                            <div class="h-px bg-slate-200 dark:bg-slate-700 my-2"></div>
                            <p class="text-xs text-secondary text-center">Select an existing goal to edit details.</p>
                        </div>
                     `;
                } else if (mode === 'goal') {
                    const g = this.goals.find(x => x.id === data);
                    if (!g) return;
                    titleEl.textContent = 'Edit Goal Details';
                    descEl.textContent = 'Make changes directly';

                    // Helpers
                    const opts = (arr, val) => arr.map(v => `<option value="${v}" ${v === val ? 'selected' : ''}>${Utils.toTitleCase(v)}</option>`).join('');

                    // Dependencies
                    const others = this.goals.filter(x => x.id !== g.id);
                    const depsHtml = others.map(o => {
                        const isChecked = (g.dependencyIds || []).includes(o.id) ? 'checked' : '';
                        return `
                        <label class="flex items-center gap-2 text-xs py-1 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 rounded px-1">
                            <input type="checkbox" class="sidebar-dep-check accent-primary" value="${o.id}" ${isChecked}>
                            <span class="truncate text-slate-600 dark:text-slate-300">${o.title}</span>
                        </label>`;
                    }).join('') || '<div class="text-xs text-secondary italic p-1">No other goals available</div>';

                    contentEl.innerHTML = `
                        <div class="flex flex-col gap-3 h-full pr-1">
                            <form onsubmit="event.preventDefault(); app.updateGoalFromSidebar('${g.id}')">
                                <!-- Title -->
                                <div class="form-group mb-2">
                                    <label class="text-[10px] font-bold text-secondary uppercase tracking-wider mb-1 block">Title</label>
                                    <input type="text" id="sb-title" class="w-full text-sm font-semibold p-2 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 focus:border-primary outline-none transition-colors" value="${g.title}" required>
                                </div>

                                <!-- Cat / Type -->
                                <div class="grid grid-cols-2 gap-2 mb-2">
                                    <div>
                                        <label class="text-[10px] text-secondary uppercase mb-1 block">Category</label>
                                        <select id="sb-category" class="w-full text-xs p-2 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 outline-none">
                                            ${opts(['work', 'personal', 'health', 'finance', 'education'], g.category)}
                                        </select>
                                    </div>
                                    <div>
                                        <label class="text-[10px] text-secondary uppercase mb-1 block">Type</label>
                                        <select id="sb-type" class="w-full text-xs p-2 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 outline-none">
                                            ${opts(['short-term', 'long-term', 'lifetime'], g.type)}
                                        </select>
                                    </div>
                                </div>

                                <!-- Priority / Status -->
                                <div class="grid grid-cols-2 gap-2 mb-2">
                                    <div>
                                        <label class="text-[10px] text-secondary uppercase mb-1 block">Priority</label>
                                        <select id="sb-priority" class="w-full text-xs p-2 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 outline-none">
                                            ${opts(['high', 'medium', 'low'], g.priority || 'medium')}
                                        </select>
                                    </div>
                                    <div>
                                        <label class="text-[10px] text-secondary uppercase mb-1 block">Status</label>
                                        <select id="sb-status" class="w-full text-xs p-2 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 outline-none">
                                            ${opts(['not-started', 'in-progress', 'completed', 'blocked'], g.status || 'not-started')}
                                        </select>
                                    </div>
                                </div>

                                <!-- Start / End -->
                                <div class="grid grid-cols-2 gap-2 mb-2">
                                    <div>
                                        <label class="text-[10px] text-secondary uppercase mb-1 block">Start</label>
                                        <input type="datetime-local" id="sb-start" class="w-full text-xs p-1 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 outline-none" value="${g.startTime || ''}">
                                    </div>
                                    <div>
                                        <label class="text-[10px] text-secondary uppercase mb-1 block">End</label>
                                        <input type="datetime-local" id="sb-end" class="w-full text-xs p-1 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 outline-none" value="${g.endTime || ''}">
                                    </div>
                                </div>

                                <!-- Dependencies -->
                                <div class="mb-2">
                                    <label class="text-[10px] text-secondary uppercase mb-1 block">Dependencies</label>
                                    <div class="max-h-24 overflow-y-auto border border-slate-200 dark:border-slate-700 rounded p-2 bg-slate-50 dark:bg-slate-900/50 custom-scrollbar">
                                        ${depsHtml}
                                    </div>
                                </div>

                                <!-- Notes -->
                                <div class="mb-4">
                                    <label class="text-[10px] text-secondary uppercase mb-1 block">Notes</label>
                                    <textarea id="sb-notes" class="w-full text-xs p-2 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 h-20 placeholder-slate-400 outline-none resize-none" placeholder="Add details...">${g.notes || ''}</textarea>
                                </div>

                                <!-- Actions -->
                                <div class="flex flex-col gap-2 pt-2 border-t border-slate-100 dark:border-slate-700">
                                    <button type="submit" class="btn btn-primary w-full shadow-sm justify-center">Save Changes</button>
                                    <button type="button" class="btn btn-secondary w-full text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 justify-center" onclick="app.deleteGoal('${g.id}')">Delete Goal</button>
                                </div>
                            </form>
                            
                            <div class="mt-2 text-center pb-4">
                                <button class="text-xs text-blue-500 underline" onclick="app.renderContextPanel('default')">Cancel & Back</button>
                            </div>
                        </div>
                     `;
                }
            }

            closePopover(e) {
                if (e) e.stopPropagation();
                const wrapper = e.target.closest('.info-tooltip-wrapper');
                if (wrapper) {
                    const popover = wrapper.querySelector('.info-popover');
                    if (popover) popover.classList.add('force-hidden');
                }
            }

            resetPopover(e) {
                const wrapper = e.target.closest('.info-tooltip-wrapper');
                if (wrapper) {
                    const popover = wrapper.querySelector('.info-popover');
                    if (popover) popover.classList.remove('force-hidden');
                }
            }

            updateColumnWidth(val) {
                const cols = document.querySelectorAll('.kanban-column');
                cols.forEach(c => c.style.minWidth = val + 'px');
            }

            handleDragOverTrash(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                document.getElementById('board-trash-zone').classList.add('drag-over');
            }

            handleDragLeaveTrash(e) {
                document.getElementById('board-trash-zone').classList.remove('drag-over');
            }

            handleDropTrash(e) {
                e.preventDefault();
                this._removeDragStyles();
                document.getElementById('board-trash-zone').classList.remove('drag-over');

                const id = e.dataTransfer.getData('text/plain');
                if (!id) return;

                if (confirm('Are you sure you want to delete this goal?')) {
                    Store.delete(id);
                    // Refresh data
                    this.goals = Store.getAll();
                    this.renderBoard(); // Render board to remove card
                    Utils.showToast('Goal deleted', 'success');
                }
            }

            setPageWidth(width) {
                const main = document.querySelector('main');
                if (main) {
                    main.style.maxWidth = width;

                    // Save preference for current page
                    const settings = JSON.parse(localStorage.getItem('goalDashSettings') || '{}');
                    if (!settings.pageWidths) settings.pageWidths = {};

                    // If we are on customize page, we might want to set global or specific?
                    // Request implies "for each page individually".
                    // However, the control is ONLY on the Customize page right now.
                    // If the user wants to set it for "Overview", they can't see the control there.
                    // Assuming the user means "Set a global default" OR "Set for THIS page type".
                    // But since the control is on a specific page, let's assume they want to configure it 
                    // generally or we need to move the control to a global place?
                    // Re-reading request: "can we add these option for each page indivisually"
                    // implies the control should be available per page OR the setting respects the current page context.
                    // Since the control is on 'Customize' page, let's assume they want to configure 'Customize' page width?
                    // OR they want to configure the *default* which applies to all?
                    // Actually, to support "each page individually", we need to store it keyed by page ID.

                    // Current behavior: The control is on the Customize Page.
                    // If I set it there, does it apply to 'Overview'?
                    // Yes, currently it sets a global 'pageWidth'.

                    // To do it "individually", we need to know WHICH page we are configuring.
                    // Since the UI is on the 'Customize' page, it's ambiguous.
                    // But I will implement the logic to APPLY specific widths if they exist.
                    // And I'll update the 'setPageWidth' to save to the *current active page* if possible,
                    // or just save as a global default if called from the settings.

                    // For now, let's save it as the "Global Preference" (which is what the previous code did)
                    // BUT also update the logic in setPage to look for specific overrides if we ever add them.
                    // Wait, if the control is ONLY on one page, I can't set different widths for different pages easily 
                    // unless I add the control to the header or every page. 

                    // Use case: User goes to Customize, sets "Overview" width? No, the dropdown doesn't say "Overview".
                    // Cop-out: I will stick to Global for now unless I add controls to every page.
                    // Re-reading: "option for each page indivisually" -> "add these option FOR each page". 
                    // This creates a UI challenge.

                    // Strategy: I will add a "Page" selector to the Layout Customization card.
                    // "Select Page: [Overview, Goals, Board, Attention, Calendar, Customize]"
                    // "Select Width: [90%, ...]"
                    // "Apply".

                    // Let's first update this method to handle the saving part.

                    if (!settings.pageWidths) settings.pageWidths = {};

                    // If a specific page argument is passed, use it. Otherwise default to 'global' or current.
                    // Actually, I'll update the UI to pass the page name.
                    // For backward compatibility, I'll just save to 'global' for now 
                    // until I update the UI in the next step.
                    settings.pageWidth = width;

                    localStorage.setItem('goalDashSettings', JSON.stringify(settings));
                    Utils.showToast(`Layout updated to ${width}`, 'success');
                }
            }

            setPageSpecificWidth(page, width) {
                const settings = JSON.parse(localStorage.getItem('goalDashSettings') || '{}');
                if (!settings.pageWidths) settings.pageWidths = {};
                settings.pageWidths[page] = width;
                localStorage.setItem('goalDashSettings', JSON.stringify(settings));

                // If we are currently ON that page, apply it immediately
                if (this.currentPage === page) {
                    const main = document.querySelector('main');
                    if (main) main.style.maxWidth = width;
                }
                Utils.showToast(`${Utils.toTitleCase(page)} width set to ${width}`, 'success');
            }

            handleWidthChange(width) {
                const target = document.getElementById('layout-target-page').value;
                if (target === 'global') {
                    this.setPageWidth(width);
                } else {
                    this.setPageSpecificWidth(target, width);
                }
            }

            // --- CALCULATIONS ---
            calculateGoalMetrics(goal) {
                const now = new Date();
                const start = goal.startTime ? new Date(goal.startTime) : null;
                const end = goal.endTime ? new Date(goal.endTime) : null;

                let timePassedPct = 0;
                let timeLeftMs = 0;
                let isOverdue = false;
                let durationString = '-';
                let leftString = '-';

                if (start && end) {
                    const totalDuration = end - start;
                    const elapsed = now - start;

                    if (totalDuration > 0) {
                        timePassedPct = Utils.clamp((elapsed / totalDuration) * 100, 0, 100);
                        if (now > end) isOverdue = true;
                        if (now < start) timePassedPct = 0;
                    }

                    if (now < end) {
                        timeLeftMs = end - now;
                        leftString = Utils.formatDuration(timeLeftMs);
                    } else if (isOverdue && goal.status !== 'completed') {
                        leftString = 'Overdue';
                    }
                }

                // Check dependencies
                let isBlockedByDep = false;
                const unresolvedDeps = [];
                if (goal.dependencyIds && goal.dependencyIds.length > 0) {
                    goal.dependencyIds.forEach(depId => {
                        const dep = this.goals.find(g => g.id === depId);
                        if (dep && dep.status !== 'completed') {
                            isBlockedByDep = true;
                            unresolvedDeps.push(dep.title);
                        }
                    });
                }

                // Effective Status (Logic: if blocked by dep, visual status is blocked, unless manually completed)
                let visualStatus = goal.status;
                if (isBlockedByDep && goal.status !== 'completed') {
                    visualStatus = 'blocked';
                }

                return { ...goal, timePassedPct, leftString, isOverdue, isBlockedByDep, unresolvedDeps, visualStatus };
            }

            // --- RENDERERS ---
            // --- ATTENTION / TIMELINE (KANBAN STYLE) ---
            renderAttention() {
                const container = document.getElementById('attention-board');
                if (!container) return;

                const now = new Date();
                now.setHours(0, 0, 0, 0);

                // Helper to format column headers
                const fmtDate = (d) => d.toLocaleDateString(undefined, { weekday: 'long', day: 'numeric', month: 'short' });
                const addDays = (d, n) => { const x = new Date(d); x.setDate(x.getDate() + n); return x; };
                const getWeekRange = (d) => {
                    const start = new Date(d);
                    const end = new Date(d);
                    end.setDate(end.getDate() + 6);
                    return `${start.getDate()} ${start.toLocaleDateString(undefined, { month: 'short' })} - ${end.getDate()} ${end.toLocaleDateString(undefined, { month: 'short' })}`;
                };



                // Define Buckets
                const todayVal = now.getTime();
                const currentYear = now.getFullYear();

                const buckets = {
                    today: { label: 'TODAY', sub: fmtDate(now), items: [], color: '#ef4444' },
                    tomorrow: { label: 'TOMORROW', sub: fmtDate(addDays(now, 1)), items: [], color: '#f97316' },
                    thisWeek: { label: 'THIS WEEK', sub: getWeekRange(addDays(now, 3)), items: [], color: '#3b82f6' },
                    nextWeek: { label: 'NEXT WEEK', sub: 'Upcoming', items: [], color: '#8b5cf6' },
                    thisYear: { label: 'THIS YEAR', sub: `${currentYear}`, items: [], color: '#06b6d4' },
                    future: { label: 'FUTURE', sub: `Beyond ${currentYear}`, items: [], color: '#10b981' }
                };

                // Filter & Sort
                this.goals.filter(g => g.status !== 'completed').forEach(g => {
                    const d = new Date(g.deadline || g.startTime || 0);
                    d.setHours(0, 0, 0, 0);
                    const t = d.getTime();
                    const gYear = d.getFullYear();

                    // If no date, put in 'Beyond'
                    if (!g.deadline && !g.startTime) {
                        buckets.future.items.push(g);
                        return;
                    }

                    const diffDays = (t - todayVal) / (1000 * 60 * 60 * 24);

                    if (diffDays <= 0) buckets.today.items.push(g);
                    else if (diffDays === 1) buckets.tomorrow.items.push(g);
                    else if (diffDays <= 7) buckets.thisWeek.items.push(g);
                    else if (diffDays <= 14) buckets.nextWeek.items.push(g);
                    else if (gYear === currentYear) buckets.thisYear.items.push(g);
                    else buckets.future.items.push(g);
                });

                // Render Columns
                container.innerHTML = Object.entries(buckets).map(([key, b]) => `
                    <div class="kanban-column" style="min-width: 320px;"
                         data-bucket="${key}"
                         ondragover="app.handleDragOver(event)"
                         ondrop="app.handleDropAttention(event, '${key}')">
                        <div class="kanban-header" style="border-bottom-color: ${b.color}; display:block;">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-bold text-sm tracking-wider">${b.label}</span>
                                <span class="badge" style="background:${b.color}20; color:${b.color}; padding:2px 8px; border-radius:12px; font-size:0.75rem;">${b.items.length}</span>
                            </div>
                            <div class="text-[11px] font-semibold text-secondary uppercase tracking-tight flex items-center gap-1">
                                <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                                ${b.sub}
                            </div>
                        </div>
                        <div class="kanban-cards-area custom-scrollbar">
                            ${b.items.length ? b.items.map(g => this.renderKanbanCard(g)).join('') :
                        `<div class="text-center text-xs text-secondary italic mt-4 opacity-50">No goals planned</div>`}
                        </div>
                    </div>
                `).join('');
            }

            updateAttentionColumnWidth(val) {
                const cols = document.querySelectorAll('#attention-board .kanban-column');
                cols.forEach(c => c.style.minWidth = val + 'px');
            }

            handleDropAttention(e, bucketId) {
                e.preventDefault();
                this._removeDragStyles();

                const id = e.dataTransfer.getData('text/plain');
                if (!id) return;

                const goal = this.goals.find(g => g.id === id);
                if (!goal) return;

                const now = new Date();
                const addDays = (n) => { const d = new Date(); d.setDate(d.getDate() + n); return d; };

                let newDate;

                // Logic for Drag Drop Date Assignment
                switch (bucketId) {
                    case 'today': newDate = now; break;
                    case 'tomorrow': newDate = addDays(1); break;
                    case 'thisWeek': newDate = addDays(3); break; // Mid-week approximation
                    case 'nextWeek': newDate = addDays(8); break; // Start of next week
                    case 'thisYear': newDate = addDays(30); break; // Some time next month or safe future in year
                    case 'future':
                        newDate = new Date();
                        newDate.setFullYear(newDate.getFullYear() + 1); // Next year
                        break;
                }

                if (newDate) {
                    // Set both start and deadline to this date for simple scheduling
                    // Maintain time if existed, else noon
                    newDate.setHours(12, 0, 0, 0);
                    goal.deadline = newDate.toISOString();
                    // Optional: Sync text status if needed, but let's keep status independent
                    Store.update(goal);
                    Utils.showToast(`Rescheduled to ${bucketId}`, 'success');
                    this.renderAttention();
                }
            }

            // --- KANBAN BOARD ---
            renderBoard() {
                const columns = [
                    { id: 'not-started', label: 'To Do', color: 'var(--c-todo)' },
                    { id: 'in-progress', label: 'In Progress', color: 'var(--c-doing)' },
                    { id: 'blocked', label: 'Blocked', color: 'var(--c-block)' },
                    { id: 'completed', label: 'Done', color: 'var(--c-done)' }
                ];

                const container = document.getElementById('kanban-container');
                if (!container) return;

                // Filter logic
                let filteredGoals = this.goals;
                // Reuse existing filter state if we want, or just custom logic?
                // The Board UI has simple Sprint/All buttons that set category
                const cat = this.filters.category;
                if (cat !== 'all') {
                    filteredGoals = filteredGoals.filter(g => g.category === cat);
                }

                container.innerHTML = columns.map(col => `
                    <div class="kanban-column"
                         data-status="${col.id}"
                         ondragover="app.handleDragOver(event)"
                         ondrop="app.handleDrop(event)">
                        <div class="kanban-header" style="border-bottom-color: ${col.color}">
                            <span>${col.label}</span>
                            <span class="badge" style="background:${col.color}20; color:${col.color}; padding:2px 8px; border-radius:12px; font-size:0.75rem;">${filteredGoals.filter(g => (g.status || 'not-started') === col.id).length}</span>
                        </div>
                        <div class="kanban-cards-area custom-scrollbar">
                            ${filteredGoals.filter(g => (g.status || 'not-started') === col.id).map(g => this.renderKanbanCard(g)).join('')}
                        </div>
                    </div>
                `).join('');
            }

            renderKanbanCard(goal) {
                const metrics = this.calculateGoalMetrics(goal);

                // Priority color
                let prioColor = 'text-gray-500';
                if (goal.priority === 'high') prioColor = 'text-red-500';
                if (goal.priority === 'medium') prioColor = 'text-orange-500';
                if (goal.priority === 'low') prioColor = 'text-green-500';

                return `
                    <div class="kanban-card"
                         draggable="true"
                         ondragstart="app.handleDragStart(event, '${goal.id}')"
                         onclick="app.editGoal('${goal.id}')">
                        <div class="flex justify-between items-start mb-2">
                             <span class="text-[10px] font-bold uppercase tracking-wider ${prioColor}">${goal.priority}</span>
                             <span class="text-[10px] text-secondary bg-slate-100 dark:bg-slate-700 px-1.5 rounded">${metrics.leftString}</span>
                        </div>
                        <h4 class="font-bold text-sm mb-2 leading-relaxed tracking-tight text-slate-800 dark:text-slate-200 break-words">${goal.title}</h4>
                        <div class="flex flex-wrap gap-1 mt-auto">
                            <span class="kanban-tag">${goal.category}</span>
                            <span class="kanban-tag">${goal.type}</span>
                        </div>
                    </div>
                `;
            }

            handleDragStart(e, id) {
                e.dataTransfer.setData('text/plain', id);
                e.dataTransfer.effectAllowed = 'move';
                e.target.classList.add('dragging');
                document.getElementById('kanban-container').classList.add('dragging-active');
            }

            handleDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                const col = e.target.closest('.kanban-column');
                if (col) col.classList.add('drag-over');
            }

            _removeDragStyles() {
                document.querySelectorAll('.kanban-column').forEach(c => c.classList.remove('drag-over'));
                document.querySelectorAll('.kanban-card').forEach(c => c.classList.remove('dragging'));
                document.getElementById('kanban-container').classList.remove('dragging-active');
            }

            handleDrop(e) {
                e.preventDefault();
                this._removeDragStyles();

                const id = e.dataTransfer.getData('text/plain');
                const col = e.target.closest('.kanban-column');
                if (!col || !id) return;

                const newStatus = col.dataset.status;
                const goal = this.goals.find(g => g.id === id);

                if (goal && goal.status !== newStatus) {
                    goal.status = newStatus;
                    Store.update(goal);
                    this.renderBoard();
                    Utils.showToast(`Moved to ${Utils.toTitleCase(newStatus)}`, 'success');
                }
            }

            renderAll() {
                // Refresh data from memory (or store if needed, but we keep sync)
                // this.goals = Store.getAll(); // Optional: if multiple tabs support needed, re-fetch here.

                if (this.currentPage === 'overview') {
                    this.renderOverview();
                } else if (this.currentPage === 'calendar') {
                    this.renderCalendar();
                } else {
                    this.renderTracking();
                }
            }

            updateFilters() {
                const searchInput = document.getElementById('filter-search');
                this.filters.search = searchInput.value;
                this.filters.category = document.getElementById('filter-category').value;
                this.filters.type = document.getElementById('filter-type').value;
                this.filters.status = document.getElementById('filter-status').value;
                this.filters.sort = document.getElementById('sort-by').value;

                // Toggle Clear Search button
                const clearBtn = document.getElementById('clear-search');
                if (clearBtn) {
                    if (this.filters.search) clearBtn.classList.remove('hidden');
                    else clearBtn.classList.add('hidden');
                }

                this.renderOverview();
            }

            clearSearch() {
                const searchInput = document.getElementById('filter-search');
                if (searchInput) {
                    searchInput.value = '';
                    this.updateFilters();
                }
            }

            setFilterCategory(cat) {
                // Toggle logic
                const newVal = this.filters.category === cat ? 'all' : cat;
                this.filters.category = newVal;
                document.getElementById('filter-category').value = newVal;
                this.renderOverview();
            }

            setFilterType(type) {
                // Toggle logic
                const newVal = this.filters.type === type ? 'all' : type;
                this.filters.type = newVal;
                document.getElementById('filter-type').value = newVal;
                this.renderOverview();
            }

            setFilterStatus(status) {
                // Toggle logic
                const newVal = this.filters.status === status ? 'all' : status;
                this.filters.status = newVal;
                const statusSelect = document.getElementById('filter-status');
                if (statusSelect) {
                    statusSelect.value = newVal;
                }
                this.renderOverview();
            }

            resetFilters() {
                this.filters = {
                    search: '',
                    category: 'all',
                    type: 'all',
                    status: 'all',
                    sort: 'priority-desc'
                };
                document.getElementById('filter-search').value = '';
                document.getElementById('filter-category').value = 'all';
                document.getElementById('filter-type').value = 'all';
                document.getElementById('filter-status').value = 'all';
                document.getElementById('sort-by').value = 'priority-desc';

                const clearBtn = document.getElementById('clear-search');
                if (clearBtn) clearBtn.classList.add('hidden');

                this.renderOverview();
            }

            getFilteredGoals() {
                let filtered = this.goals.map(g => this.calculateGoalMetrics(g));

                // 1. Search
                if (this.filters.search) {
                    const term = this.filters.search.toLowerCase();
                    filtered = filtered.filter(g => g.title.toLowerCase().includes(term) || (g.notes && g.notes.toLowerCase().includes(term)));
                }

                // 2. Category
                if (this.filters.category !== 'all') {
                    filtered = filtered.filter(g => g.category === this.filters.category);
                }

                // 2.5. Type
                if (this.filters.type && this.filters.type !== 'all') {
                    filtered = filtered.filter(g => g.type === this.filters.type);
                }

                // 3. Status
                if (this.filters.status !== 'all') {
                    if (this.filters.status === 'overdue') {
                        filtered = filtered.filter(g => g.isOverdue && g.status !== 'completed');
                    } else {
                        filtered = filtered.filter(g => g.visualStatus === this.filters.status);
                    }
                }

                // 4. Sort
                filtered.sort((a, b) => {
                    const getPriorityVal = (p) => p === 'high' ? 3 : p === 'medium' ? 2 : 1;

                    if (this.filters.sort === 'priority-desc') return getPriorityVal(b.priority) - getPriorityVal(a.priority);
                    if (this.filters.sort === 'priority-asc') return getPriorityVal(a.priority) - getPriorityVal(b.priority);
                    if (this.filters.sort === 'end-asc') return (new Date(a.endTime || '9999') - new Date(b.endTime || '9999'));
                    if (this.filters.sort === 'end-desc') return (new Date(b.endTime || 0) - new Date(a.endTime || 0));
                    return 0;
                });

                return filtered;
            }

            renderOverview() {
                // 1. Get Base Goals (Filtered by Category & Type & Search ONLY, ignoring Status)
                // We need this so the "Status Cards" show counts relative to the current Category/Search context.
                let goalsForStats = this.goals.map(g => this.calculateGoalMetrics(g));

                if (this.filters.search) {
                    const term = this.filters.search.toLowerCase();
                    goalsForStats = goalsForStats.filter(g => g.title.toLowerCase().includes(term) || (g.notes && g.notes.toLowerCase().includes(term)));
                }
                if (this.filters.category !== 'all') {
                    goalsForStats = goalsForStats.filter(g => g.category === this.filters.category);
                }
                if (this.filters.type && this.filters.type !== 'all') {
                    goalsForStats = goalsForStats.filter(g => g.type === this.filters.type);
                }

                // 2. Calculate Stats from this context-aware set
                const totalCount = goalsForStats.length;
                const stats = {
                    total: totalCount,
                    inProgress: goalsForStats.filter(g => g.status === 'in-progress').length,
                    completed: goalsForStats.filter(g => g.status === 'completed').length,
                    blocked: goalsForStats.filter(g => g.visualStatus === 'blocked').length,
                    overdue: goalsForStats.filter(g => g.isOverdue && g.status !== 'completed').length
                };
                // Helper for percentage
                // Helper for percentage (kept for other uses if any, else can be removed)
                const getPct = (val) => totalCount > 0 ? Math.round((val / totalCount) * 100) : 0;

                // 3. Get Goals for the List (Applying ALL filters including Status)
                const processedGoals = this.getFilteredGoals();

                // --- RESTORED COUNTS & ICONS LOGIC ---
                // We calculate these based on the current filters so they act as "facet counts"

                // 1. Status buttons: Filter by Category + Type + Search
                const goalsForStatus = goalsForStats;
                const countTodo = goalsForStatus.filter(g => g.status === 'not-started').length;
                const countDoing = goalsForStatus.filter(g => g.status === 'in-progress').length;
                const countDone = goalsForStatus.filter(g => g.status === 'completed').length;
                const countBlock = goalsForStatus.filter(g => g.visualStatus === 'blocked').length;
                const countOverdue = goalsForStatus.filter(g => g.isOverdue && g.status !== 'completed').length;

                // 2. Category buttons: Filter by Type + Search + Status
                let goalsForCategory = this.goals.map(g => this.calculateGoalMetrics(g));
                if (this.filters.search) {
                    const term = this.filters.search.toLowerCase();
                    goalsForCategory = goalsForCategory.filter(g => g.title.toLowerCase().includes(term) || (g.notes && g.notes.toLowerCase().includes(term)));
                }
                if (this.filters.type && this.filters.type !== 'all') {
                    goalsForCategory = goalsForCategory.filter(g => g.type === this.filters.type);
                }
                if (this.filters.status !== 'all') {
                    if (this.filters.status === 'overdue') goalsForCategory = goalsForCategory.filter(g => g.isOverdue && g.status !== 'completed');
                    else goalsForCategory = goalsForCategory.filter(g => g.visualStatus === this.filters.status);
                }
                const countShort = goalsForCategory.filter(g => g.category === 'short-term').length;
                const countLong = goalsForCategory.filter(g => g.category === 'long-term').length;

                // 3. Type buttons: Filter by Category + Search + Status
                let goalsForType = this.goals.map(g => this.calculateGoalMetrics(g));
                if (this.filters.search) {
                    const term = this.filters.search.toLowerCase();
                    goalsForType = goalsForType.filter(g => g.title.toLowerCase().includes(term) || (g.notes && g.notes.toLowerCase().includes(term)));
                }
                if (this.filters.category !== 'all') {
                    goalsForType = goalsForType.filter(g => g.category === this.filters.category);
                }
                if (this.filters.status !== 'all') {
                    if (this.filters.status === 'overdue') goalsForType = goalsForType.filter(g => g.isOverdue && g.status !== 'completed');
                    else goalsForType = goalsForType.filter(g => g.visualStatus === this.filters.status);
                }
                const countProf = goalsForType.filter(g => g.type === 'professional').length;
                const countPers = goalsForType.filter(g => g.type === 'personal').length;

                // Update DOM elements
                const safeSet = (idCount, idPct, val, total) => {
                    const elC = document.getElementById(idCount);
                    if (elC) elC.textContent = val;
                    const elP = document.getElementById(idPct);
                    if (elP) elP.textContent = total > 1 ? '(' + Math.round((val / total) * 100) + '%)' : (val > 0 ? '(100%)' : '(0%)');
                };

                safeSet('count-btn-all', null, goalsForStats.length, totalCount);
                safeSet('count-btn-overdue', 'pct-btn-overdue', countOverdue, totalCount);
                safeSet('count-btn-todo', 'pct-btn-todo', countTodo, totalCount);
                safeSet('count-btn-doing', 'pct-btn-doing', countDoing, totalCount);
                safeSet('count-btn-done', 'pct-btn-done', countDone, totalCount);
                safeSet('count-btn-blocked', 'pct-btn-blocked', countBlock, totalCount);

                safeSet('count-btn-short', 'pct-btn-short', countShort, goalsForCategory.length);
                safeSet('count-btn-long', 'pct-btn-long', countLong, goalsForCategory.length);
                safeSet('count-btn-prof', 'pct-btn-prof', countProf, goalsForType.length);
                safeSet('count-btn-pers', 'pct-btn-pers', countPers, goalsForType.length);

                // Update Icons based on currentSettings
                const updateIcon = (btnId, iconName) => {
                    const btn = document.getElementById(btnId);
                    if (!btn) return;
                    const iconContainer = btn.querySelector('.filter-icon-container');
                    if (iconContainer) {
                        iconContainer.innerHTML = this.getIconSvg(iconName);
                        // Ensure it has the filter-icon class for styling
                        const svg = iconContainer.querySelector('svg');
                        if (svg) svg.classList.add('filter-icon');
                    }
                };

                if (this.currentSettings) {
                    updateIcon('btn-all', this.currentSettings.iconTotal || 'grid');
                    updateIcon('btn-status-not-started', this.currentSettings.iconTodo || 'square');
                    updateIcon('btn-status-in-progress', this.currentSettings.iconInProgress || 'circle-poly');
                    updateIcon('btn-status-completed', this.currentSettings.iconCompleted || 'check-circle');
                    updateIcon('btn-status-blocked', this.currentSettings.iconBlocked || 'ban-red');
                    updateIcon('btn-overdue', this.currentSettings.iconOverdue || 'clock');
                }

                // Update Results Counter
                const counterEl = document.getElementById('results-counter');
                if (counterEl) {
                    counterEl.innerHTML = `Showing <span>${processedGoals.length}</span> of <span>${this.goals.length}</span> goals`;
                }

                // Split Lists
                const shortTerm = processedGoals.filter(g => g.category === 'short-term');
                const longTerm = processedGoals.filter(g => g.category === 'long-term');

                document.getElementById('count-short').textContent = `${shortTerm.length} items`;
                document.getElementById('count-long').textContent = `${longTerm.length} items`;

                const renderCard = (g) => {
                    // Helper for urgency color
                    let timeClass = 'text-slate-500';
                    if (g.daysLeft !== undefined) {
                        if (g.daysLeft < 3) timeClass = 'text-red-500 font-bold bg-red-50 dark:bg-red-900/10 px-1 rounded';
                        else if (g.daysLeft < 7) timeClass = 'text-amber-500 font-medium bg-amber-50 dark:bg-amber-900/10 px-1 rounded';
                        else timeClass = 'text-emerald-600 bg-emerald-50 dark:bg-emerald-900/10 px-1 rounded';
                    }
                    if (g.isOverdue) timeClass = 'text-red-600 font-bold bg-red-100 dark:bg-red-900/30 px-1 rounded animate-pulse';

                    // Format Progress
                    const pct = Math.round(g.timePassedPct || 0);
                    const safePct = Math.min(Math.max(pct, 0), 100);

                    // Category/Type Icons
                    const catIcon = g.category === 'long-term' ? '' : '';
                    const typeIcon = g.type === 'professional' ? '' : '';

                    return `
                    <div class="goal-card group priority-${g.priority}" 
                         data-id="${g.id}"
                         onclick="app.editGoal('${g.id}')">
                        
                        <div class="card-main">
                            <!-- Left Section: Title, Notes, Badges -->
                            <div class="card-left">
                                <div class="flex justify-between items-start">
                                    <h4 class="font-bold text-sm leading-relaxed tracking-tight text-slate-800 dark:text-slate-100 group-hover:text-primary transition-colors break-words">${g.title}</h4>
                                </div>
                                
                                ${g.notes ? `<p class="line-clamp-2 text-[11px] text-slate-500 dark:text-slate-400 leading-tight">${g.notes}</p>` : ''}
                                
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="badge badge-priority-${g.priority} text-[9px] py-0.5 px-1.5">
                                        <span class="w-1 h-1 rounded-full bg-current opacity-40"></span>
                                        ${Utils.toTitleCase(g.priority)}
                                    </span>
                                </div>
                            </div>

                            <!-- Right Section: Progress & Status (Right Middle aligned) -->
                            <div class="card-right">
                                <span class="badge badge-status-${g.visualStatus} text-[9px] py-0.5 px-1.5 whitespace-nowrap">
                                    ${Utils.toTitleCase(g.visualStatus)}
                                </span>
                                
                                <div class="w-full">
                                    <div class="flex justify-between items-center text-[8px] font-bold text-slate-400 mb-0.5 uppercase tracking-tighter">
                                        <span>${safePct}%</span>
                                    </div>
                                    <div class="h-1 bg-slate-100 dark:bg-slate-700/50 rounded-full overflow-hidden">
                                        <div class="h-full rounded-full transition-all duration-1000 ease-out ${g.visualStatus === 'completed' ? 'bg-gradient-to-r from-emerald-400 to-emerald-600' : 'bg-gradient-to-r from-blue-400 to-indigo-600'}" 
                                             style="width: ${safePct}%"></div>
                                    </div>
                                </div>
                                
                                <div class="absolute right-1 top-1 action-menu-container">
                                    <button class="card-action-trigger p-1" onclick="event.stopPropagation(); app.toggleCardMenu('${g.id}')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
                                    </button>
                                    <div id="menu-${g.id}" class="hidden absolute right-0 top-8 w-36 bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-slate-100 dark:border-slate-700 z-50 py-1">
                                        <button class="w-full text-left px-3 py-1.5 text-[11px] hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center gap-2" onclick="event.stopPropagation(); app.duplicateGoal('${g.id}')"> Duplicate</button>
                                        <button class="w-full text-left px-3 py-1.5 text-[11px] hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center gap-2 text-red-500" onclick="event.stopPropagation(); app.deleteGoal('${g.id}')"> Delete</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Footer Meta -->
                        <div class="card-footer-compact">
                            <div class="flex items-center gap-2 truncate pr-2">
                                <span class="badge badge-category-${g.category} text-[9px] py-0.5 px-1.5 border" title="Category">
                                    ${Utils.capitalize(g.category.replace('-', ' '))}
                                </span>
                                <span class="opacity-30">|</span>
                                <span title="Type" class="text-[10px] opacity-80">${typeIcon} ${Utils.capitalize(g.type)}</span>
                            </div>
                            
                            ${g.leftString !== '-' ? `
                                <div class="flex items-center gap-1 shrink-0 ${timeClass}">
                                    <svg width="8" height="8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                    <span>${g.leftString}</span>
                                </div>
                            ` : ''}
                        </div>

                        ${g.isBlockedByDep ? `
                        <div class="flex items-center gap-1.5 text-[8px] text-rose-500 font-bold bg-rose-50 dark:bg-rose-900/10 p-1 px-2 rounded-md border border-rose-100 dark:border-rose-900/20 mt-0.5">
                            <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                            <span class="truncate">Blocked by: ${g.unresolvedDeps.slice(0, 1).join(', ')}${g.unresolvedDeps.length > 1 ? ` +${g.unresolvedDeps.length - 1}` : ''}</span>
                        </div>
                        ` : ''}
                    </div>
                `};

                document.getElementById('list-short-term').innerHTML = shortTerm.map(renderCard).join('') || '<div class="text-secondary text-sm">No goals found.</div>';
                document.getElementById('list-long-term').innerHTML = longTerm.map(renderCard).join('') || '<div class="text-secondary text-sm">No goals found.</div>';
            }

            renderChart(stats) {
                const container = document.getElementById('status-chart');
                const max = Math.max(stats.total, 1); // Avoid div by zero
                const getHeight = val => Math.max((val / max) * 100, 4) + '%';

                const items = [
                    { label: 'To Do', val: stats.total - stats.inProgress - stats.completed - stats.blocked, color: '#94a3b8', filter: 'not-started' },
                    { label: 'Active', val: stats.inProgress, color: '#3b82f6', filter: 'in-progress' },
                    { label: 'Done', val: stats.completed, color: '#10b981', filter: 'completed' },
                    { label: 'Block', val: stats.blocked, color: '#ef4444', filter: 'blocked' }
                ];

                container.innerHTML = items.map(i => `
                    <div class="bar-group clickable" onclick="app.setFilterStatus('${i.filter}')">
                        <div class="bar" style="height: ${getHeight(i.val)}; background-color: ${i.color}"></div>
                        <span class="bar-label">${i.label}</span>
                        <span class="text-xs font-bold">${i.val}</span>
                    </div>
                `).join('');
            }

            renderTracking() {
                // Populate dependencies dropdown
                // Populate dependencies checklist
                const depContainer = document.getElementById('goal-dependencies-container');
                const currentId = document.getElementById('goal-id').value;

                // Get available goals (excluding self)
                const availableGoals = this.goals.filter(g => g.id !== currentId);

                if (availableGoals.length === 0) {
                    depContainer.innerHTML = '<div class="text-xs text-secondary italic p-1">No other goals available.</div>';
                } else {
                    depContainer.innerHTML = availableGoals.map(g => `
                        <label class="flex items-center gap-2 p-1.5 hover:bg-slate-50 dark:hover:bg-slate-800 rounded cursor-pointer">
                            <input type="checkbox" value="${g.id}" name="goal-dep" class="form-checkbox h-4 w-4 text-primary rounded border-gray-300">
                            <span class="text-sm select-none">${g.title}</span>
                        </label>
                     `).join('');
                }

                // Restore selection logic is complex here if we just blindly re-render. 
                // Better strategy: Only update list if count changes or just let the edit function handle selection.
                // For now, simple re-render might lose selection if typing. 
                // FIX: Only render options if dropdown is empty or we explicitly ask for refresh. 
                // Let's assume renderTracking is called on page switch or table update, not keystroke.

                // Restore selection if converting from select? No, renderTracking is called often. 
                // Issue: If we just re-render, we lose checked state if not saved.
                // But 'renderTracking' is usually called on Tab Switch.
                // If editing, 'editGoal' will re-check them. 
                // If adding new, none should be checked.
                // So simple render is fine.

                this.renderGoalsTable();
            }

            // --- SETTINGS MGT ---
            saveSettings() {
                const settings = {
                    title: document.getElementById('setting-title').value,
                    color: document.getElementById('setting-color').value,
                    font: document.getElementById('setting-font').value,
                    size: document.getElementById('setting-size').value,
                    case: document.getElementById('setting-case').value,
                    weight: document.getElementById('setting-weight').value,
                    italic: document.getElementById('setting-italic').checked,
                    spacing: document.getElementById('setting-spacing').value,

                    subtitle: document.getElementById('setting-subtitle').value,
                    subColor: document.getElementById('setting-sub-color').value,
                    subFont: document.getElementById('setting-sub-font').value,
                    subSize: document.getElementById('setting-sub-size').value,
                    subCase: document.getElementById('setting-sub-case').value,
                    subWeight: document.getElementById('setting-sub-weight').value,
                    subItalic: document.getElementById('setting-sub-italic').checked,
                    subSpacing: document.getElementById('setting-sub-spacing').value,

                    dateFont: document.getElementById('setting-date-font').value,
                    dateSize: document.getElementById('setting-date-size').value,
                    timeFont: document.getElementById('setting-time-font').value,
                    timeSize: document.getElementById('setting-time-size').value,
                    dtSeconds: document.getElementById('setting-dt-seconds').classList.contains('active'),
                    dtFormat: document.getElementById('setting-dt-format').value,
                    dtTimeFormat: document.getElementById('setting-dt-time-format').value,
                    dateColor: document.getElementById('setting-date-color').value,
                    timeColor: document.getElementById('setting-time-color').value,

                    // Icons
                    iconTotal: this.currentSettings?.iconTotal || 'list',
                    iconTodo: this.currentSettings?.iconTodo || 'square',
                    iconInProgress: this.currentSettings?.iconInProgress || 'gears',
                    iconCompleted: this.currentSettings?.iconCompleted || 'checklist',
                    iconBlocked: this.currentSettings?.iconBlocked || 'ban',
                    iconOverdue: this.currentSettings?.iconOverdue || 'alert'
                };
                localStorage.setItem('goalDashSettings', JSON.stringify(settings));
                this.applySettings(settings);
                alert('Dashboard settings saved!');
            }

            loadSettings() {
                const stored = localStorage.getItem('goalDashSettings');
                if (stored) {
                    const settings = JSON.parse(stored);
                    document.getElementById('setting-title').value = settings.title || '';

                    // Title Defaults
                    const color = settings.color || '#0d9488';
                    document.getElementById('setting-color').value = color;
                    document.getElementById('setting-color-preview').style.backgroundColor = color;

                    document.getElementById('setting-font').value = settings.font || 'Inter, sans-serif';
                    document.getElementById('setting-size').value = settings.size || '2.5rem';
                    document.getElementById('setting-case').value = settings.case || 'none';
                    document.getElementById('setting-weight').value = settings.weight || 'bold';
                    document.getElementById('setting-italic').checked = settings.italic || false;
                    document.getElementById('setting-spacing').value = settings.spacing || 'normal';

                    // Subtitle Defaults
                    document.getElementById('setting-subtitle').value = settings.subtitle || '';

                    const subColor = settings.subColor || '#64748b';
                    document.getElementById('setting-sub-color').value = subColor;
                    document.getElementById('setting-sub-color-preview').style.backgroundColor = subColor;

                    document.getElementById('setting-sub-font').value = settings.subFont || 'Inter, sans-serif';
                    document.getElementById('setting-sub-size').value = settings.subSize || '1.1rem';
                    document.getElementById('setting-sub-case').value = settings.subCase || 'none';
                    document.getElementById('setting-sub-weight').value = settings.subWeight || 'normal';
                    document.getElementById('setting-sub-italic').checked = settings.subItalic || false;
                    document.getElementById('setting-sub-spacing').value = settings.subSpacing || 'normal';

                    // Date & Time Defaults
                    document.getElementById('setting-date-font').value = settings.dateFont || settings.dtFont || 'inherit';
                    document.getElementById('setting-date-size').value = settings.dateSize || settings.dtSize || '1';

                    document.getElementById('setting-time-font').value = settings.timeFont || settings.dtFont || 'inherit';
                    document.getElementById('setting-time-size').value = settings.timeSize || settings.dtSize || '1';

                    document.getElementById('setting-dt-time-format').value = settings.dtTimeFormat || '12';

                    const secBtn = document.getElementById('setting-dt-seconds');
                    const isSec = settings.dtSeconds || false;
                    secBtn.classList.toggle('active', isSec);
                    secBtn.textContent = isSec ? 'On' : 'Off';

                    // Date & Time Colors (New Split)
                    const dColor = settings.dateColor || settings.dtColor || '#64748b';
                    document.getElementById('setting-date-color').value = dColor;
                    const dPrev = document.getElementById('preview-date-color');
                    if (dPrev) dPrev.style.backgroundColor = dColor;

                    const tColor = settings.timeColor || settings.dtColor || '#000000';
                    document.getElementById('setting-time-color').value = tColor;
                    const tPrev = document.getElementById('preview-time-color');
                    if (tPrev) tPrev.style.backgroundColor = tColor;

                    // Icon Selection
                    this.currentSettings = settings; // Store for access
                    this.renderIconPickerState(); // Update UI based on initial dropdown selection

                    this.applySettings(settings);
                } else {
                    // Initialize with default Teal if nothing saved
                    const defaultSettings = {
                        color: '#0d9488', font: 'Inter, sans-serif', size: '2.5rem', case: 'none',
                        weight: '900', italic: false, spacing: '-0.03em',
                        subColor: '#64748b', subFont: 'Inter, sans-serif', subSize: '1.1rem', subCase: 'none',
                        subWeight: '400', subItalic: false, subSpacing: 'normal'
                    };
                    this.applySettings(defaultSettings);

                    // Update Inputs to defaults
                    document.getElementById('setting-color').value = '#0d9488';
                    document.getElementById('setting-color-preview').style.backgroundColor = '#0d9488';
                    document.getElementById('setting-weight').value = '900';
                    document.getElementById('setting-spacing').value = '-0.03em';

                    document.getElementById('setting-sub-color').value = '#64748b';
                    document.getElementById('setting-sub-color-preview').style.backgroundColor = '#64748b';
                }
            }

            updateClock() {
                const now = new Date();
                const dEl = document.getElementById('date-display');
                const tEl = document.getElementById('time-display');

                if (dEl && tEl) {
                    const dateOpts = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                    dEl.textContent = now.toLocaleDateString('en-US', dateOpts);

                    const is12h = (this.currentSettings?.dtTimeFormat !== '24');
                    const timeOpts = {
                        hour: 'numeric',
                        minute: '2-digit',
                        hour12: is12h
                    };
                    if (this.currentSettings?.dtSeconds) {
                        timeOpts.second = '2-digit';
                    }
                    tEl.textContent = now.toLocaleTimeString('en-US', timeOpts);
                }

                if (this.clockTimer) clearTimeout(this.clockTimer);
                this.clockTimer = setTimeout(() => this.updateClock(), 1000);
            }

            applySettings(settings) {
                this.currentSettings = settings; // Ensure updateClock sees these
                const titleEl = document.getElementById('app-title');
                const subtitleEl = document.getElementById('app-subtitle');

                // Helper for text case
                const applyTextCase = (text, caseType) => {
                    if (!text) return '';
                    if (caseType === 'camel') {
                        // Camel Case Logic
                        return text.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g, (m, chr) => chr.toUpperCase());
                    }
                    // For CSS handled cases (upper, lower, capitalize) we just return text
                    // But wait, to be safe let's let CSS handle it if possible, but for camel we must transform text content.
                    return text;
                };

                // Apply Title Content
                // Apply Title Content
                let titleText = settings.title || 'My Strategy 2026';
                if (settings.case === 'camel') {
                    titleEl.textContent = applyTextCase(titleText, 'camel');
                    titleEl.style.textTransform = 'none';
                } else {
                    titleEl.textContent = titleText;
                    titleEl.style.textTransform = settings.case || 'none';
                }

                // Apply Title Styles
                if (settings.color) titleEl.style.color = settings.color;
                if (settings.font) titleEl.style.fontFamily = settings.font;
                if (settings.size) titleEl.style.fontSize = settings.size;
                if (settings.weight) titleEl.style.fontWeight = settings.weight;
                titleEl.style.fontStyle = settings.italic ? 'italic' : 'normal';
                if (settings.spacing) titleEl.style.letterSpacing = settings.spacing;

                // Apply Subtitle Content
                if (settings.subtitle) {
                    let subText = settings.subtitle;
                    if (settings.subCase === 'camel') {
                        subtitleEl.textContent = applyTextCase(subText, 'camel');
                        subtitleEl.style.textTransform = 'none';
                    } else {
                        subtitleEl.textContent = subText;
                        subtitleEl.style.textTransform = settings.subCase || 'none';
                    }

                    subtitleEl.style.display = 'block';
                    // Apply Subtitle Styles
                    if (settings.subColor) subtitleEl.style.color = settings.subColor;
                    if (settings.subFont) subtitleEl.style.fontFamily = settings.subFont;
                    if (settings.subSize) subtitleEl.style.fontSize = settings.subSize;
                    if (settings.subWeight) subtitleEl.style.fontWeight = settings.subWeight;
                    subtitleEl.style.fontStyle = settings.subItalic ? 'italic' : 'normal';
                    if (settings.subSpacing) subtitleEl.style.letterSpacing = settings.subSpacing;
                } else {
                    subtitleEl.style.display = 'none';
                }

                // Apply Date & Time Styles
                const dtContainer = document.getElementById('header-datetime');
                if (dtContainer) {
                    // Reset container font/size as we now apply individually
                    dtContainer.style.fontFamily = 'inherit';

                    const dEl = document.getElementById('date-display');
                    const tEl = document.getElementById('time-display');

                    // Date Styles
                    if (dEl) {
                        dEl.style.fontFamily = settings.dateFont || settings.dtFont || 'inherit';
                        // Handle Date Size (Scale)
                        const dSize = settings.dateSize || settings.dtSize || '1';
                        dEl.style.fontSize = (1 * parseFloat(dSize)) + 'rem'; // Base 1rem * multiplier
                        // However, previous implementation used scale on container.
                        // Let's use font-size directly for cleaner separate control.
                        // Wait, previous used transform: scale().
                        // Let's try font-size: calc(1rem * size).
                        // Note: Default size option values are 0.8, 1, 1.2.
                        // Let's assume the base size for date is roughly 0.875rem (text-sm) or 1rem.
                        // Let's apply font-size relative to base.
                        dEl.style.fontSize = `${parseFloat(dSize)}em`;
                    }

                    // Time Styles
                    if (tEl) {
                        tEl.style.fontFamily = settings.timeFont || settings.dtFont || 'inherit';
                        const tSize = settings.timeSize || settings.dtSize || '1';
                        // Time is usually larger (text-4xl = 2.25rem).
                        // If we use em, it scales relative to parent.
                        // Let's just use the multiplier on the current base size.
                        // Actually, simplest is to use 'em' so it multiplies whatever class it has.
                        tEl.style.fontSize = `${parseFloat(tSize) * 2.5}rem`; // Preserving rough relation if base is 2.5rem
                        // Wait, time-display class is text-4xl (2.25rem) or similar.
                        // Let's check original render. It was transform-scale on the whole block.
                        // If I remove scale, I need to be careful.
                        // Let's assume the user wants relative sizing.
                        // Let's try standard em scaling.
                        tEl.style.fontSize = `${parseFloat(tSize) * 2.25}rem`;
                    }

                    // Split Colors
                    const dColor = settings.dateColor || settings.dtColor;
                    if (dColor) document.getElementById('date-display').style.color = dColor;

                    const tColor = settings.timeColor || settings.dtColor;
                    if (tColor) document.getElementById('time-display').style.color = tColor;

                    // Remove old container scale if present
                    dtContainer.style.transform = 'none';
                }
                this.updateClock();
            }

            // Helper: Select Icon
            selectIcon(iconName) {
                if (!this.currentSettings) this.currentSettings = {};

                const target = document.getElementById('icon-target-select').value; // 'total', 'inProgress', etc.
                const key = 'icon' + target.charAt(0).toUpperCase() + target.slice(1); // iconTotal

                this.currentSettings[key] = iconName;
                this.updateIconSelectionUI(iconName);
            }

            renderIconPickerState() {
                const target = document.getElementById('icon-target-select').value;
                const key = 'icon' + target.charAt(0).toUpperCase() + target.slice(1);

                // Defaults
                const defaults = {
                    'iconTotal': 'list',
                    'iconTodo': 'square',
                    'iconInProgress': 'gears',
                    'iconCompleted': 'checklist',
                    'iconBlocked': 'ban',
                    'iconOverdue': 'alert'
                };

                const currentIcon = this.currentSettings?.[key] || defaults[key] || 'gears';
                this.updateIconSelectionUI(currentIcon);
            }

            updateIconSelectionUI(selectedIcon) {
                document.querySelectorAll('.icon-option').forEach(btn => {
                    if (btn.dataset.icon === selectedIcon) {
                        btn.classList.add('bg-blue-100', 'dark:bg-blue-900', 'border-blue-500');
                    } else {
                        btn.classList.remove('bg-blue-100', 'dark:bg-blue-900', 'border-blue-500');
                    }
                });
            }

            getIconSvg(name) {
                const icons = {
                    'gears': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 9a2 2 0 0 1-2 2H6l-4 4 4 4h6a2 2 0 0 1 2 2v1h5v-5a2 2 0 0 1 2-2h-3"/><path d="M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z" opacity="0.5"/><path d="M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"/><path d="M12 2v2m0 16v2m9-9h-2M5 12H3m14.5-4.5-1.5 1.5m-10 10-1.5 1.5m0-13 1.5 1.5m10 10 1.5 1.5"/></svg>`,
                    'mid-target': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>`,
                    'checklist': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>`,
                    'lightning': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>`,
                    'play': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>`,
                    'loader': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>`,
                    'rocket': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/></svg>`,
                    'tools': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>`,
                    'cycling': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="5.5" cy="17.5" r="3.5"/><circle cx="18.5" cy="17.5" r="3.5"/><path d="M15 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-3 11.5V14l-3-3 4-3 2 3h2"/></svg>`,
                    'trend': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>`,
                    'refresh': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>`,
                    'star': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>`,
                    'lock': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>`,
                    'ban': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line></svg>`,
                    'alert': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>`,
                    'list': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>`,
                    'grid': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>`,
                    'clock': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>`,
                    'square': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/></svg>`,
                    'circle-poly': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>`,
                    'check-circle': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>`,
                    'ban-red': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m4.9 4.9 14.2 14.2"/></svg>`,
                    'hourglass': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 22h14"/><path d="M5 2h14"/><path d="M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22"/><path d="M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2"/></svg>`,
                    'trees': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M7 3v18"/><path d="M7 8h3"/><path d="M7 16h3"/><path d="M17 3v18"/><path d="M14 8h3"/><path d="M14 16h3"/><path d="M12 3v18"/></svg>`,
                    'briefcase': `<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M20 7h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v3H4c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2zM10 4h4v3h-4V4z"/></svg>`,
                    'home': `<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>`,
                    'user': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`,
                    'users': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>`,
                    'calendar': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>`,
                    'mail': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>`,
                    'heart': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>`,
                    'smile': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>`,
                    'flag': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>`,
                    'bookmark': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>`,
                    'camera': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>`,
                    'edit': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>`,
                    'trash': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>`,
                    'folder': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>`,
                    'file': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/><polyline points="13 2 13 9 20 9"/></svg>`,
                    'image': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>`,
                    'music': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>`,
                    'video': `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>`
                };
                return icons[name] || icons['gears'];
            }
            renderGoalsTable() {
                // 1. Populate Dynamic Selective Filters (Used Categories Only)
                const populateSelect = (id, values, label) => {
                    const el = document.getElementById(id);
                    if (!el) return;
                    const current = el.value;

                    let html = `<option value="all">All ${label}</option>`;
                    [...new Set(values)].filter(v => v).sort().forEach(v => {
                        html += `<option value="${v}" ${v === current ? 'selected' : ''}>${Utils.toTitleCase(v)}</option>`;
                    });
                    el.innerHTML = html;
                };

                populateSelect('t-filter-category', this.goals.map(g => g.category), 'Categories');
                populateSelect('t-filter-type', this.goals.map(g => g.type), 'Types');
                populateSelect('t-filter-priority', this.goals.map(g => g.priority), 'Priorities');
                populateSelect('t-filter-status', this.goals.map(g => this.calculateGoalMetrics(g).visualStatus), 'Status');

                // 2. Get Filtered Data for Table
                let processed = this.goals.map(g => this.calculateGoalMetrics(g));

                // Read Table Filter Values
                const fCat = document.getElementById('t-filter-category')?.value || 'all';
                const fType = document.getElementById('t-filter-type')?.value || 'all';
                const fPrio = document.getElementById('t-filter-priority')?.value || 'all';
                const fStat = document.getElementById('t-filter-status')?.value || 'all';

                if (fCat !== 'all') processed = processed.filter(g => g.category === fCat);
                if (fType !== 'all') processed = processed.filter(g => g.type === fType);
                if (fPrio !== 'all') processed = processed.filter(g => g.priority === fPrio);
                if (fStat !== 'all') processed = processed.filter(g => g.visualStatus === fStat);

                // 3. Render Table
                const tbody = document.getElementById('goals-table-body');
                if (processed.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="7" class="empty-state">No goals found matching Filters.</td></tr>`;
                    return;
                }

                tbody.innerHTML = processed.map(g => {
                    // Safety check for deadline/endTime
                    const dateStr = g.endTime || g.deadline || '';
                    const displayDate = dateStr ? dateStr.replace('T', ' ') : '-';

                    return `
                    <tr>
                        <td>
                            <div style="font-weight: 600">${g.title}</div>
                        </td>
                        <td>
                            <span class="badge badge-category-${g.category}">${Utils.toTitleCase(g.category)}</span>
                        </td>
                        <td>
                            <span class="text-sm text-secondary">${Utils.toTitleCase(g.type)}</span>
                        </td>
                        <td>
                             <span class="text-sm font-bold" style="color: ${g.priority === 'high' ? '#ef4444' : (g.priority === 'medium' ? '#d97706' : '#10b981')}; font-size: 0.75rem;">
                                ${Utils.toTitleCase(g.priority)}
                             </span>
                        </td>
                        <td class="text-sm">
                            <div style="font-weight: 500;">${displayDate}</div>
                            <div class="text-xs text-secondary">${g.leftString}</div>
                        </td>
                        <td>
                            <span class="badge badge-status-${g.visualStatus}">${Utils.toTitleCase(g.visualStatus || 'not-started')}</span>
                        </td>
                        <td>
                            <div class="flex gap-2">
                                <button class="btn btn-secondary btn-icon" onclick="app.editGoal('${g.id}')" title="Edit"></button>
                                <button class="btn btn-secondary btn-icon" onclick="app.duplicateGoal('${g.id}')" title="Duplicate">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                </button>
                                <button class="btn btn-danger btn-icon" onclick="app.deleteGoal('${g.id}')" title="Delete"></button>
                            </div>
                        </td>
                    </tr>
                `}).join('');
            }
            // --- ACTIONS ---
            handleFormSubmit(e) {
                e.preventDefault();

                const id = document.getElementById('goal-id').value;
                const title = document.getElementById('goal-title').value;
                const category = document.getElementById('goal-category').value;
                const type = document.getElementById('goal-type').value;
                const priority = document.getElementById('goal-priority').value;
                const status = document.getElementById('goal-status').value;
                const start = document.getElementById('goal-start').value;
                const end = document.getElementById('goal-end').value;
                const notes = document.getElementById('goal-notes').value;

                const depContainer = document.getElementById('goal-dependencies-container');
                const dependencyIds = Array.from(depContainer.querySelectorAll('input[name="goal-dep"]:checked')).map(cb => cb.value);

                // Validation
                if (start && end && new Date(end) < new Date(start)) {
                    Utils.showToast('End time cannot be before start time', 'error');
                    return;
                }

                const goal = {
                    id: id || Utils.generateId(),
                    title,
                    category,
                    type,
                    priority,
                    status,
                    startTime: start,
                    endTime: end,
                    notes,
                    dependencyIds,
                    createdAt: Date.now()
                };

                if (id) {
                    Store.update(goal);
                    Utils.showToast('Goal updated successfully', 'success');
                } else {
                    Store.add(goal);
                    Utils.showToast('Goal created successfully', 'success');
                }

                this.resetForm();
                this.init(); // Refresh everything
            }

            toggleCardMenu(id) {
                const menu = document.getElementById(`menu-${id}`);
                const isHidden = menu.classList.contains('hidden');

                // Close all other menus first
                document.querySelectorAll('[id^="menu-"]').forEach(el => el.classList.add('hidden'));

                if (isHidden) {
                    menu.classList.remove('hidden');
                }
            }

            editGoal(id) {
                const goal = this.goals.find(g => g.id === id);
                if (!goal) return;

                // switch to 'tracking' page if not there
                this.setPage('tracking');

                // Switch to Add/Edit Tab
                this.setTrackingTab('tab-add');

                // Populate Form
                document.getElementById('form-title').innerText = 'Edit Goal';
                document.getElementById('goal-id').value = goal.id;
                document.getElementById('goal-title').value = goal.title;
                document.getElementById('goal-category').value = goal.category;
                document.getElementById('goal-type').value = goal.type;
                document.getElementById('goal-priority').value = goal.priority || 'medium';
                // document.getElementById('goal-deadline').value = goal.deadline; // This line was removed as 'deadline' is not in the goal object
                document.getElementById('goal-status').value = goal.status;
                document.getElementById('goal-start').value = goal.startTime || ''; // Added start time
                document.getElementById('goal-end').value = goal.endTime || ''; // Added end time
                document.getElementById('goal-notes').value = goal.notes || '';

                // Scroll to form top
                document.getElementById('form-title').scrollIntoView({ behavior: 'smooth' });

                // Dependencies
                // Force re-render of checklist to ensure 'current goal' is excluded
                this.renderTracking();

                // Now check the boxes
                if (goal.dependencyIds && goal.dependencyIds.length > 0) {
                    const checkboxes = document.querySelectorAll('#goal-dependencies-container input[name="goal-dep"]');
                    checkboxes.forEach(cb => {
                        if (goal.dependencyIds.includes(cb.value)) cb.checked = true;
                    });
                }

                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            duplicateGoal(id) {
                const goal = this.goals.find(g => g.id === id);
                if (!goal) return;

                const newGoal = { ...goal, id: Utils.generateId(), title: goal.title + ' (Copy)', createdAt: Date.now() };
                Store.add(newGoal);
                this.init();
                Utils.showToast('Goal duplicated', 'success');
            }

            deleteGoal(id) {
                if (confirm('Are you sure you want to delete this goal?')) {
                    Store.delete(id);
                    this.init();
                    Utils.showToast('Goal deleted');
                }
            }

            updateGoalFromSidebar(id) {
                const g = this.goals.find(x => x.id === id);
                if (!g) return;

                // 1. Gather Data
                g.title = document.getElementById('sb-title').value;
                g.category = document.getElementById('sb-category').value;
                g.type = document.getElementById('sb-type').value;
                g.priority = document.getElementById('sb-priority').value;
                g.status = document.getElementById('sb-status').value;
                g.startTime = document.getElementById('sb-start').value;
                g.endTime = document.getElementById('sb-end').value;
                g.notes = document.getElementById('sb-notes').value;

                const checks = document.querySelectorAll('.sidebar-dep-check:checked');
                g.dependencyIds = Array.from(checks).map(c => c.value);

                // 2. Save
                Store.update(g);

                // 3. Refresh UI
                Utils.showToast('Goal details updated');

                this.renderUnscheduledList();
                this.renderGoalsTable();
                if (this.calendar) this.calendar.refetchEvents();

                // Show feedback
                const btn = document.querySelector('#ctx-content .btn-primary');
                if (btn) {
                    const originalText = btn.textContent;
                    btn.textContent = 'Saved!';
                    btn.style.backgroundColor = 'var(--success-color)';
                    btn.style.borderColor = 'var(--success-color)';
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.style.backgroundColor = '';
                        btn.style.borderColor = '';
                    }, 1500);
                }
            }

            resetForm() {
                document.getElementById('goal-form').reset();
                document.getElementById('goal-id').value = '';
                document.getElementById('form-title').innerText = 'Add New Goal';
                this.setTrackingTab('tab-list'); // Go back to list on cancel/reset
                // Reset dep select
                // Reset dep checklist
                const checkboxes = document.querySelectorAll('#goal-dependencies-container input[name="goal-dep"]');
                checkboxes.forEach(cb => cb.checked = false);
            }

            resetFilters() {
                document.getElementById('filter-category').value = 'all';
                document.getElementById('filter-type').value = 'all';
                document.getElementById('filter-status').value = 'all';
                document.getElementById('sort-by').value = 'priority-desc';
                this.filters = { search: '', category: 'all', type: 'all', status: 'all', sort: 'priority-desc' };
                this.renderOverview();
            }

            generateDemoData() {
                if (!confirm('This will clear current data and add sample goals. Proceed?')) return;

                const now = Date.now();
                const day = 86400000;

                const demoGoals = [
                    // SHORT TERM
                    { id: 'd1', title: 'Finish Project Alpha Deliverables', category: 'short-term', type: 'professional', priority: 'high', status: 'in-progress', startTime: new Date(now - day).toISOString().slice(0, 16), endTime: new Date(now + day * 2).toISOString().slice(0, 16), notes: 'Critical Q1 priority', createdAt: now },
                    { id: 'd2', title: 'Read "Atomic Habits" Ch 1-3', category: 'short-term', type: 'personal', priority: 'medium', status: 'not-started', startTime: new Date(now).toISOString().slice(0, 16), endTime: new Date(now + day * 5).toISOString().slice(0, 16), notes: 'Evening reading', createdAt: now },
                    { id: 'd3', title: 'Update LinkedIn Profile', category: 'short-term', type: 'professional', priority: 'medium', status: 'completed', startTime: new Date(now - day * 3).toISOString().slice(0, 16), endTime: new Date(now - day).toISOString().slice(0, 16), notes: 'Added new certification', createdAt: now },
                    { id: 'd4', title: 'Weekly Grocery Run', category: 'short-term', type: 'personal', priority: 'low', status: 'not-started', startTime: new Date(now - day * 0.5).toISOString().slice(0, 16), endTime: new Date(now + day * 0.2).toISOString().slice(0, 16), notes: 'Buy milk and eggs', createdAt: now }, // Due soon
                    { id: 'd5', title: 'Organize Garage', category: 'short-term', type: 'personal', priority: 'low', status: 'blocked', startTime: new Date(now).toISOString().slice(0, 16), endTime: new Date(now + day * 7).toISOString().slice(0, 16), notes: 'Waiting for new shelving units', createdAt: now },

                    // LONG TERM
                    { id: 'd6', title: 'Buy a House', category: 'long-term', type: 'personal', priority: 'high', status: 'in-progress', startTime: new Date(now - day * 60).toISOString().slice(0, 16), endTime: new Date(now + day * 300).toISOString().slice(0, 16), notes: 'Savings goal: $50k', createdAt: now },
                    { id: 'd7', title: 'Learn Spanish', category: 'long-term', type: 'personal', priority: 'medium', status: 'in-progress', startTime: new Date(now - day * 20).toISOString().slice(0, 16), endTime: new Date(now + day * 180).toISOString().slice(0, 16), notes: 'Duolingo streak: 20 days', createdAt: now },
                    { id: 'd8', title: 'Get Senior Promotion', category: 'long-term', type: 'professional', priority: 'high', status: 'not-started', startTime: new Date(now).toISOString().slice(0, 16), endTime: new Date(now + day * 120).toISOString().slice(0, 16), notes: 'Requires leading 2 major projects', createdAt: now },
                    { id: 'd9', title: 'Travel to Japan', category: 'long-term', type: 'personal', priority: 'low', status: 'not-started', startTime: new Date(now + day * 30).toISOString().slice(0, 16), endTime: new Date(now + day * 90).toISOString().slice(0, 16), notes: 'Planning for spring', createdAt: now },
                    { id: 'd10', title: 'Run a Marathon', category: 'long-term', type: 'personal', priority: 'medium', status: 'blocked', startTime: new Date(now).toISOString().slice(0, 16), endTime: new Date(now + day * 150).toISOString().slice(0, 16), notes: 'Need to recover from knee injury first', createdAt: now, dependencyIds: [] }
                ];

                // Add dependencies
                demoGoals[9].dependencyIds = [demoGoals[4].id]; // Marathon blocked by Garage (logic mismatch but valid structure test)

                Store.saveAll(demoGoals);
                this.init();
                Utils.showToast('Demo data loaded!', 'success');
            }

            // Sync with UI inputs
            renderOverview = this.renderOverview.bind(this);

            clearAllData() {
                if (confirm("DANGER: This will permanently delete all your goals. Are you sure?")) {
                    Store.clear();
                    this.init();
                    Utils.showToast('All data cleared', 'error');
                }
            }
        }

        // --- INIT ---
        function toggleDarkMode() {
            document.body.classList.toggle('dark');
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const btn = document.getElementById('dark-toggle-btn');
            if (document.body.classList.contains('dark')) {
                btn.innerText = '';
            } else {
                btn.innerText = '';
            }
        }

        // Init Theme based on system preference
        function initTheme() {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (prefersDark) {
                document.body.classList.add('dark');
            }
            updateThemeIcon();
        }

        // Call init
        initTheme();
        const dataStore = DataService; // Expose for HTML buttons
        const app = new GoalApp();

        // Expose app for UI event handlers
        window.app = app;
        window.dataStore = dataStore;

    </script>
    <input type="file" id="import-file" style="display:none" onchange="DataService.importData(this)">

    <!-- Import Mode Modal -->
    <div id="import-modal"
        class="fixed inset-0 z-[200] hidden bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4">
        <div
            class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-sm w-full overflow-hidden border border-slate-200 dark:border-slate-700 animate-in fade-in zoom-in duration-200">
            <div class="p-8 text-center">
                <div
                    class="w-16 h-16 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full flex items-center justify-center mx-auto mb-5">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2.5">
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-slate-800 dark:text-white mb-2">Import Data</h3>
                <p class="text-slate-500 dark:text-slate-400 text-sm mb-8 leading-relaxed">Choose how you want to
                    integrate these goals into your current dashboard.</p>

                <div class="flex flex-col gap-3">
                    <button onclick="DataService.confirmImport('append')"
                        class="btn-premium-action btn-blue-hover w-full justify-center py-3.5 shadow-lg shadow-blue-500/10">
                        Append to Existing
                    </button>
                    <button onclick="DataService.confirmImport('replace')"
                        class="btn-premium-action btn-red-hover w-full justify-center py-3.5 text-red-500 group">
                        Replace Everything
                    </button>
                    <button onclick="DataService.closeImportModal()"
                        class="mt-2 text-sm text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>